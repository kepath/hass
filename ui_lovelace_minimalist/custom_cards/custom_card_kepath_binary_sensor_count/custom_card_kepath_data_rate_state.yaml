---
custom_card_kepath_data_rate_state:
  variables:
    ulm_card_kepath_binary_sensor_count_notifications:
      data_rate_value:
        entity: "sensor.binary_sensor_state_counts"
        is_attribute: >
          [[[
            var isValueAttribute = true;
            if (variables?.ulm_card_kepath_binary_sensor_count_notifications?.data_rate_value?.is_attribute) {
              if (typeof variables.ulm_card_kepath_binary_sensor_count_notifications.data_rate_value.is_attribute === "boolean") {
                isValueAttribute = variables.ulm_card_kepath_binary_sensor_count_notifications.data_rate_value.is_attribute;
              }
            }
            return isValueAttribute;
          ]]]
        attribute_name: "unknown_value"
  # state:
  #   - operator: "template"
  #     value: >
  #       [[[
  #           var attributeValue = "unknown";
  #           if (variables?.ulm_card_kepath_binary_sensor_count_notifications?.data_rate_value?.attribute_name) {
  #             attributeValue = states[variables.ulm_card_kepath_binary_sensor_count_notifications.data_rate_value.entity].attributes[variables.ulm_card_kepath_binary_sensor_count_notifications.data_rate_value.attribute_name];
  #           }
  #           if(attributeValue == "unknown") {
  #             return true;
  #           }
  #           return false;
  #       ]]]
  #     icon: "mdi:numeric-off"

  icon: >
    [[[
      var icon = "mdi:numeric-off";
      //var amountValue = 0;
      //var icon = "mdi:numeric-0-circle";
      var attributeValue = "unknown";
      if (variables?.ulm_card_kepath_binary_sensor_count_notifications?.data_rate_value?.attribute_name) {
        attributeValue = states[variables.ulm_card_kepath_binary_sensor_count_notifications.data_rate_value.entity].attributes[variables.ulm_card_kepath_binary_sensor_count_notifications.data_rate_value.attribute_name];
      }
      //if (variables.notification_counts.is_attribute) {
      //  amountValue = states[variables?.notification_counts?.entity]?.attributes[variables?.notification_counts?.attribute_name] ? states[variables.notification_counts.entity].attributes[variables.notification_counts.attribute_name] : 0;
      //} else {
      //  amountValue = states[variables?.notification_counts?.entity]?.state ? states[variables.notification_counts.entity].state : 0;
      //}
      if (!isNaN(attributeValue) && attributeValue !== undefined){
        icon = "mdi:numeric-0";
        if (attributeValue > 9) {
          var attributeValue = "9-plus";
        }
        icon = icon.replace("0",attributeValue);
      }
      return icon;
    ]]]
  styles:
    icon:
      - width: "150%"
      - height: "150%"
      - color: >
          [[[
            var color = "rgba(var(--color-grey),1)";
            var attributeValue = "unknown";
            if (variables?.ulm_card_kepath_binary_sensor_count_notifications?.data_rate_value?.attribute_name) {
              attributeValue = states[variables.ulm_card_kepath_binary_sensor_count_notifications.data_rate_value.entity].attributes[variables.ulm_card_kepath_binary_sensor_count_notifications.data_rate_value.attribute_name];
            }
            if (!isNaN(attributeValue) && attributeValue !== undefined){
              switch(attributeValue) {
                case 0:
                case 1:
                case 2:
                case 3:
                case 4:
                case 5:
                  color = "rgba(var(--color-green),1)";
                  break;
                case 6:
                case 7:
                case 8:
                case 9:
                  color = "rgba(var(--color-yellow),1)";
                  break;
                default:
                  color = "rgba(var(--color-red),1)";
                  break;
              }
            }
            return color;
          ]]]
    img_cell:
      - background-color: >
          [[[
            var color = "rgba(var(--color-grey),0.2)";
            var attributeValue = "unknown";
            if (variables?.ulm_card_kepath_binary_sensor_count_notifications?.data_rate_value?.attribute_name) {
              attributeValue = states[variables.ulm_card_kepath_binary_sensor_count_notifications.data_rate_value.entity].attributes[variables.ulm_card_kepath_binary_sensor_count_notifications.data_rate_value.attribute_name];
            }
            if (!isNaN(attributeValue) && attributeValue !== undefined){
              switch(attributeValue) {
                case 0:
                case 1:
                case 2:
                case 3:
                case 4:
                case 5:
                  color = "rgba(var(--color-green),0.2)";
                  break;
                case 6:
                case 7:
                case 8:
                case 9:
                  color = "rgba(var(--color-yellow),0.2)";
                  break;
                default:
                  color = "rgba(var(--color-red),0.2)";
                  break;
              }
            }
            return color;
          ]]]

    # - operator: "template"
    #   value: >
    #     [[[
    #         var attributeValue = 0;
    #         if (variables?.ulm_card_kepath_binary_sensor_count_notifications?.data_rate_value?.attribute_name) {
    #           attributeValue = states[variables.ulm_card_kepath_binary_sensor_count_notifications.data_rate_value.entity].attributes[variables.ulm_card_kepath_binary_sensor_count_notifications.data_rate_value.attribute_name];
    #         }
    #         if(attributeValue > -60) {
    #           return true;
    #         }
    #         return false;
    #     ]]]
    #   icon: "mdi:signal-cellular-3"
    #   styles:
    #     icon:
    #       - color: "rgba(var(--color-green),1)"
    #     img_cell:
    #       - background-color: "rgba(var(--color-green), 0.2)"

    # - operator: "default"
    #   icon: "mdi:signal-cellular-outline"
    #   styles:
    #     icon:
    #       - color: "rgba(var(--color-purple),1)"
    #     img_cell:
    #       - background-color: "rgba(var(--color-purple), 0.2)"
