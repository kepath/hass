---
icon_set_color:
  variables:
    ulm_card_kepath_binary_sensor_count_notifications:
      unavailable:
        entity: "sensor.binary_sensor_state_counts"
        is_attribute: >
          [[[
            var isValueAttribute = true;
            if (variables?.ulm_card_kepath_binary_sensor_count_notifications?.unavailable?.is_attribute) {
              if (typeof variables.ulm_card_kepath_binary_sensor_count_notifications.unavailable.is_attribute === "boolean") {
                isValueAttribute = variables.ulm_card_kepath_binary_sensor_count_notifications.unavailable.is_attribute;
              }
            }
            return isValueAttribute;
          ]]]
        attribute_name: "zero_value"
    ulm_card_kepath_extra_templates_alternative_state_appearance:
      default_icon: >
        [[[
          var setIcon = "mdi:close-circle";
          if (entity?.attributes?.icon) {
            setIcon = entity.attributes.icon;
          }
          if (variables?.ulm_card_kepath_extra_templates_alternative_state_appearance?.default_icon) {
            setIcon = variables.ulm_card_kepath_extra_templates_alternative_state_appearance.default_icon;
          }
          return setIcon;
        ]]]
      default_color: >
        [[[
          var setColor = "grey";
          const color_options = ['grey', 'red', 'green', 'yellow', 'blue', 'purple', 'pink'];
          if (variables?.ulm_card_kepath_extra_templates_alternative_state_appearance?.default_color) {
            for (let i = 0; i < color_options.length; i++) {
              if (color_options[i] == variables.ulm_card_kepath_extra_templates_alternative_state_appearance.default_color) {
                setColor = color_options[i];
              }
            }
          }
          return setColor;
        ]]]
      triggered_icon: >
        [[[
          var setIcon = "mdi:close-circle";
          if (entity?.attributes?.icon) {
            setIcon = entity.attributes.icon;
          }
          if (variables?.ulm_card_kepath_extra_templates_alternative_state_appearance?.triggered_icon) {
            setIcon = variables.ulm_card_kepath_extra_templates_alternative_state_appearance.triggered_icon;
          }
          return setIcon;
        ]]]
      triggered_color: >
        [[[
          var defaultColor = "grey";
          const color_options = ['grey', 'red', 'green', 'yellow', 'blue', 'purple', 'pink'];
          if (variables?.ulm_card_kepath_extra_templates_alternative_state_appearance?.triggered_color) {
            for (let i = 0; i < color_options.length; i++) {
              if (color_options[i] == variables.ulm_card_kepath_extra_templates_alternative_state_appearance.triggered_color) {
                defaultColor = color_options[i];
              }
            }
          }
          return defaultColor;
        ]]]
      trigger_on_unavailable: >
        [[[
          var unavailableTrigger = false;
          if (variables?.ulm_card_kepath_extra_templates_alternative_state_appearance?.trigger_on_unavailable) {
            if (typeof variables.ulm_card_kepath_extra_templates_alternative_state_appearance.trigger_on_unavailable === "boolean") {
              unavailableTrigger = variables.ulm_card_kepath_extra_templates_alternative_state_appearance.trigger_on_unavailable;
            }
          }
          return unavailableTrigger;
        ]]]
  state:
    - operator: "template"
      value: >
        [[[
          var amountValue = 0;
          if (variables.ulm_card_kepath_binary_sensor_count_notifications.unavailable.is_attribute) {
            amountValue =
              states[variables?.ulm_card_kepath_binary_sensor_count_notifications?.unavailable?.entity]?.attributes[variables?.ulm_card_kepath_binary_sensor_count_notifications?.unavailable?.attribute_name]
                ? states[variables.ulm_card_kepath_binary_sensor_count_notifications.unavailable.entity].attributes[variables.ulm_card_kepath_binary_sensor_count_notifications.unavailable.attribute_name]
                : 0;
          } else {
            amountValue =
              states[variables?.ulm_card_kepath_binary_sensor_count_notifications?.unavailable?.entity]?.state
                ? states[variables.ulm_card_kepath_binary_sensor_count_notifications.unavailable.entity].state
                : 0;
          }
          return (entity.state == 'on' || entity.state == 'recording' || entity.state == 'idle' || entity.state == 'away'
            || (variables.ulm_card_kepath_extra_templates_alternative_state_appearance.trigger_on_unavailable && amountValue != 0))
        ]]]
      icon: >
        [[[
          return variables.ulm_card_kepath_extra_templates_alternative_state_appearance.triggered_icon;
        ]]]
      styles:
        icon:
          - color: >
              [[[
                return `rgba(var(--color-${variables.ulm_card_kepath_extra_templates_alternative_state_appearance.triggered_color}),1)`;
              ]]]
        img_cell:
          - background-color: >
              [[[
                return `rgba(var(--color-${variables.ulm_card_kepath_extra_templates_alternative_state_appearance.triggered_color}), 0.2)`;
              ]]]
    - operator: "default"
      icon: >
        [[[
          return variables.ulm_card_kepath_extra_templates_alternative_state_appearance.default_icon;
        ]]]
      styles:
        icon:
          - color: >
              [[[
                return `rgba(var(--color-${variables.ulm_card_kepath_extra_templates_alternative_state_appearance.default_color}),1)`;
              ]]]
        img_cell:
          - background-color: >
              [[[
                return `rgba(var(--color-${variables.ulm_card_kepath_extra_templates_alternative_state_appearance.default_color}), 0.2)`;
              ]]]
