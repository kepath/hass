---
generic_set_icon_and_color:
  variables:
    ulm_card_kepath_generic_icon_appearance:
      default:
        icon: >
          [[[
            var setIcon = "mdi:close-circle";
            if (entity?.attributes?.icon) {
              setIcon = entity.attributes.icon;
            }
            if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme) {
              if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme?.default_state) {
                if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme?.default_state?.icon) {
                  setIcon = variables.ulm_card_kepath_extra_templates_icon_appearance.default_theme.default_state.icon;
                }
              }
            }
            if (hass.themes.darkMode) {
              if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme) {
                if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme?.default_state) {
                  if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme?.default_state?.icon) {
                    setIcon = variables.ulm_card_kepath_extra_templates_icon_appearance.dark_theme.default_state.icon;
                  }
                }
              }
            }
            return setIcon;
          ]]]
        icon_color: >
          [[[
            var setColor = "grey";
            if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme) {
              if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme?.default_state) {
                if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme?.default_state?.icon_color) {
                  setColor = variables.ulm_card_kepath_extra_templates_icon_appearance.default_theme.default_state.icon_color;
                }
              }
            }
            if (hass.themes.darkMode) {
              if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme) {
                if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme?.default_state) {
                  if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme?.default_state?.icon_color) {
                    setColor = variables.ulm_card_kepath_extra_templates_icon_appearance.dark_theme.default_state.icon_color;
                  }
                }
              }
            }
            return setColor;
          ]]]
        background_color: >
          [[[
            var setBGColor = "var(--primary-text-color)";
            if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme) {
              if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme?.default_state) {
                if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme?.default_state?.background_color) {
                  setBGColor = variables.ulm_card_kepath_extra_templates_icon_appearance.default_theme.default_state.background_color;
                }
              }
            }
            if (hass.themes.darkMode) {
              if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme) {
                if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme?.default_state) {
                  if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme?.default_state?.background_color) {
                    setBGColor = variables.ulm_card_kepath_extra_templates_icon_appearance.dark_theme.default_state.background_color;
                  }
                }
              }
            }
            return setBGColor;
          ]]]
      triggered:
        icon: >
          [[[
            var setIcon = "mdi:close-circle";
            if (entity?.attributes?.icon) {
              setIcon = entity.attributes.icon;
            }
            if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme) {
              if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme?.triggered_state) {
                if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme?.triggered_state?.icon) {
                  setIcon = variables.ulm_card_kepath_extra_templates_icon_appearance.default_theme.triggered_state.icon;
                }
              }
            }
            if (hass.themes.darkMode) {
              if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme) {
                if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme?.triggered_state) {
                  if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme?.triggered_state?.icon) {
                    setIcon = variables.ulm_card_kepath_extra_templates_icon_appearance.dark_theme.triggered_state.icon;
                  }
                }
              }
            }
            return setIcon;
          ]]]
        icon_color: >
          [[[
            var setColor = "grey";
            if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme) {
              if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme?.triggered_state) {
                if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme?.triggered_state?.icon_color) {
                  setColor = variables.ulm_card_kepath_extra_templates_icon_appearance.default_theme.triggered_state.icon_color;
                }
              }
            }
            if (hass.themes.darkMode) {
              if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme) {
                if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme?.triggered_state) {
                  if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme?.triggered_state?.icon_color) {
                    setColor = variables.ulm_card_kepath_extra_templates_icon_appearance.dark_theme.triggered_state.icon_color;
                  }
                }
              }
            }
            return setColor;
          ]]]
        background_color: >
          [[[
            var setBGColor = "var(--primary-text-color)";
            if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme) {
              if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme?.triggered_state) {
                if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme?.triggered_state?.background_color) {
                  setBGColor = variables.ulm_card_kepath_extra_templates_icon_appearance.default_theme.triggered_state.background_color;
                }
              }
            }
            if (hass.themes.darkMode) {
              if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme) {
                if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme?.triggered_state) {
                  if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme?.triggered_state?.background_color) {
                    setBGColor = variables.ulm_card_kepath_extra_templates_icon_appearance.dark_theme.triggered_state.background_color;
                  }
                }
              }
            }
            return setBGColor;
          ]]]
  state:
    - operator: "template"
      value: >
        [[[
          return (entity.state == 'on' || entity.state == 'recording' || entity.state == 'idle' || entity.state == 'away')
        ]]]
      icon: >
        [[[
          var icon = "mdi:close-circle";
          if (variables.ulm_card_kepath_generic_icon_appearance.triggered.icon != icon) {
            icon = variables.ulm_card_kepath_generic_icon_appearance.triggered.icon;
          } else {
            icon = variables.ulm_card_kepath_generic_icon_appearance.default.icon;
          }
          return icon;
        ]]]
      styles:
        icon:
          - color: >
              [[[
                var setColor = "grey";
                if (variables.ulm_card_kepath_generic_icon_appearance.triggered.icon_color != setColor) {
                  setColor = variables.ulm_card_kepath_generic_icon_appearance.triggered.icon_color;
                } else {
                  setColor = variables.ulm_card_kepath_generic_icon_appearance.default.icon_color;
                }
                return setColor;
              ]]]
        img_cell:
          - background-color: >
              [[[
                var setBGColor = "var(--primary-text-color)";
                if (variables.ulm_card_kepath_generic_icon_appearance.triggered.background_color != setBGColor) {
                  setBGColor = variables.ulm_card_kepath_generic_icon_appearance.triggered.background_color;
                } else {
                  setBGColor = variables.ulm_card_kepath_generic_icon_appearance.default.background_color;
                }
                return setBGColor;
              ]]]
    - operator: "default"
      icon: "[[[ return variables.ulm_card_kepath_generic_icon_appearance.default.icon; ]]]"
      styles:
        icon:
          - color: "[[[ return variables.ulm_card_kepath_generic_icon_appearance.default.icon_color; ]]]"
        img_cell:
          - background-color: "[[[ return variables.ulm_card_kepath_generic_icon_appearance.default.background_color; ]]]"

# hass.callService('system_log', 'write', {level:'info',message:'mode.dark.default.icon '+setIcon});
