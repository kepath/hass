---
device_kepath_entity_and_style_data_rate_state:
  # variables:
  #   var_kepath_device_entity_and_style_binary_count_state:
  #     entity:
  #       evaluated_entity: "sensor.binary_sensor_state_counts"
  #       isattribute: true
  #       evaluated_attribute: "data_rate_total_value_10_times_smaller"
  #     style:
  #       use_themes: true
  #       icon: "mdi:numeric-off"
  #       icon_color: "blue"
  #       background_color: "blue"

  state:
    - operator: "template"
      value: >
        [[[
          var evaluatedDataValueEntity = "sensor.binary_sensor_state_counts";
          var evaluatedDataValueAttribute = "data_rate_total_value_10_times_smaller";

          var resolvedDataValueStateDefault = 0;
          var resolvedDataValueState;
          var returnValue = false;

          resolvedDataValueState = states[evaluatedDataValueEntity].attributes[evaluatedDataValueAttribute];
          if (isNaN(resolvedDataValueState) || typeof resolvedDataValueState === 'undefined') {
              resolvedDataValueState = resolvedDataValueStateDefault;
          }
          if (resolvedDataValueState > 0) {
            returnValue = true;
          }

          //hass.callService('system_log', 'write', {level:'warning',message:'resolvedDataValueState: ' + resolvedDataValueState});

          return returnValue;
        ]]]
      icon: >
        [[[
          var returnedIcon = "mdi:numeric-off";
          var evaluatedDataValueEntity = "sensor.binary_sensor_state_counts";
          var evaluatedDataValueAttribute = "data_rate_total_value_10_times_smaller";

          var resolvedDataValueState;

          resolvedDataValueState = states[evaluatedDataValueEntity].attributes[evaluatedDataValueAttribute];
          if (!isNaN(resolvedDataValueState) && typeof resolvedDataValueState !== 'undefined') {
            returnedIcon = "mdi:numeric-0";
            if (resolvedDataValueState > 9) {
              resolvedDataValueState = "9-plus";
            }
            returnedIcon = returnedIcon.replace("0",resolvedDataValueState);
          }

          return returnedIcon;
        ]]]
      styles:
        icon:
          - width: "150%"
          - height: "150%"
          - color: >
              [[[
                var returnedColor = "rgba(var(--color-blue),1)";
                var evaluatedDataValueEntity = "sensor.binary_sensor_state_counts";
                var evaluatedDataValueAttribute = "data_rate_total_value_10_times_smaller";

                var resolvedDataValueState;

                resolvedDataValueState = states[evaluatedDataValueEntity].attributes[evaluatedDataValueAttribute];
                if (!isNaN(resolvedDataValueState) && typeof resolvedDataValueState !== 'undefined') {
                  switch(resolvedDataValueState) {
                    case 0:
                    case 1:
                    case 2:
                    case 3:
                      returnedColor = "rgba(var(--color-green),1)";
                      break;
                    case 4:
                    case 5:
                    case 6:
                      returnedColor = "rgba(var(--color-yellow),1)";
                      break;
                    case 7:
                    case 8:
                    case 9:
                    default:
                      returnedColor = "rgba(var(--color-red),1)";
                      break;
                  }
                }
                return returnedColor;
              ]]]
        img_cell:
          - background-color: >
              [[[
                var returnedColor = "rgba(var(--color-blue),0.2)";
                var evaluatedDataValueEntity = "sensor.binary_sensor_state_counts";
                var evaluatedDataValueAttribute = "data_rate_total_value_10_times_smaller";

                var resolvedDataValueState;

                resolvedDataValueState = states[evaluatedDataValueEntity].attributes[evaluatedDataValueAttribute];
                if (!isNaN(resolvedDataValueState) && typeof resolvedDataValueState !== 'undefined') {
                  switch(resolvedDataValueState) {
                    case 0:
                    case 1:
                    case 2:
                    case 3:
                      returnedColor = "rgba(var(--color-green),0.2)";
                      break;
                    case 4:
                    case 5:
                    case 6:
                      returnedColor = "rgba(var(--color-yellow),0.2)";
                      break;
                    case 7:
                    case 8:
                    case 9:
                    default:
                      returnedColor = "rgba(var(--color-red),0.2)";
                      break;
                  }
                }
                return returnedColor;
              ]]]
