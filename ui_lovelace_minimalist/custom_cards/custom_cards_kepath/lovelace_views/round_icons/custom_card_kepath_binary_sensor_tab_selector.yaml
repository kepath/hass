---
custom_card_kepath_binary_sensor_tab_selector:
  template:
    - "icon_info_bg"
    - "ulm_translation_engine"
    - "custom_card_kepath_binary_sensor_tab_selector_input_switcher"
    - "ulm_card_kepath_constants"
    - "generic_set_icon_and_color"
  variables:
    ulm_card_kepath_extra_templates_icon_appearance:
      evaluated_object: >
        [[[
          var entity = entity.entity_id;
          if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.evaluated_object) {
            entity = variables.ulm_card_kepath_extra_templates_icon_appearance.evaluated_object;
          }
          return entity;
        ]]]
      # evaluated_state: >
      #   [[[
      #     var evaluatedState;
      #     if (variables?.ulm_card_kepath_binary_sensor_count_notifications) {
      #       if (variables?.ulm_card_kepath_binary_sensor_count_notifications?.main_icon_trigger) {
      #         switch (variables.ulm_card_kepath_binary_sensor_count_notifications.main_icon_trigger) {
      #           case "unavailable":
      #             if (variables?.ulm_card_kepath_binary_sensor_count_notifications) {
      #               if (variables?.ulm_card_kepath_binary_sensor_count_notifications?.unavailable) {
      #                 if (variables?.ulm_card_kepath_binary_sensor_count_notifications?.unavailable?.is_attribute) {
      #                   if (variables.ulm_card_kepath_binary_sensor_count_notifications.unavailable.is_attribute) {
      #                     if (variables?.ulm_card_kepath_binary_sensor_count_notifications?.unavailable?.source_entity) {
      #                       if (variables?.ulm_card_kepath_binary_sensor_count_notifications?.unavailable?.attribute_name) {
      #                         evaluatedState = states[variables.ulm_card_kepath_binary_sensor_count_notifications.unavailable.source_entity]?.attributes[variables.ulm_card_kepath_binary_sensor_count_notifications.unavailable.attribute_name] ?
      #                           states[variables.ulm_card_kepath_binary_sensor_count_notifications.unavailable.source_entity].attributes[variables.ulm_card_kepath_binary_sensor_count_notifications.unavailable.attribute_name] : 0;
      #                       }
      #                     }
      #                   } else {
      #                     if (variables?.ulm_card_kepath_binary_sensor_count_notifications?.unavailable?.source_entity) {
      #                       evaluatedState = states[variables.ulm_card_kepath_binary_sensor_count_notifications.unavailable.source_entity]?.state ?
      #                         states[variables.ulm_card_kepath_binary_sensor_count_notifications.unavailable.source_entity].state : 0;
      #                     }
      #                   }
      #                 }
      #               }
      #             }
      #             break;
      #           case "amount":
      #           default:
      #             if (variables?.ulm_card_kepath_binary_sensor_count_notifications) {
      #               if (variables?.ulm_card_kepath_binary_sensor_count_notifications?.amount) {
      #                 if (variables?.ulm_card_kepath_binary_sensor_count_notifications?.amount?.is_attribute) {
      #                   if (variables.ulm_card_kepath_binary_sensor_count_notifications.amount.is_attribute) {
      #                     if (variables?.ulm_card_kepath_binary_sensor_count_notifications?.amount?.source_entity) {
      #                       if (variables?.ulm_card_kepath_binary_sensor_count_notifications?.amount?.attribute_name) {
      #                         evaluatedState = states[variables.ulm_card_kepath_binary_sensor_count_notifications.amount.source_entity]?.attributes[variables.ulm_card_kepath_binary_sensor_count_notifications.amount.attribute_name] ?
      #                           states[variables.ulm_card_kepath_binary_sensor_count_notifications.amount.source_entity].attributes[variables.ulm_card_kepath_binary_sensor_count_notifications.amount.attribute_name] : 0;
      #                       }
      #                     }
      #                   } else {
      #                     if (variables?.ulm_card_kepath_binary_sensor_count_notifications?.amount?.source_entity) {
      #                       evaluatedState = states[variables.ulm_card_kepath_binary_sensor_count_notifications.amount.source_entity]?.state ?
      #                         states[variables.ulm_card_kepath_binary_sensor_count_notifications.amount.source_entity].state : 0;
      #                     }
      #                   }
      #                 }
      #               }
      #             }
      #             break;
      #         }
      #       }
      #     }

      #     return evaluatedState;
      #   ]]]
      use_theme_colors: >
        [[[
          var useThemeColors = true;
          if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.use_theme_colors) {
            useThemeColors = variables.ulm_card_kepath_extra_templates_icon_appearance.use_theme_colors;
          }
          return useThemeColors;
        ]]]
      default_theme:
        default_state:
          icon: >
            [[[
              var defaultThemeDefaultStateIcon = "";
              if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme) {
                if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme?.default_state) {
                  if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme?.default_state?.icon) {
                    defaultThemeDefaultStateIcon = variables.ulm_card_kepath_extra_templates_icon_appearance.default_theme.default_state.icon;
                  }
                }
              }
              return defaultThemeDefaultStateIcon;
            ]]]
          icon_color: >
            [[[
              var defaultThemeDefaultStateIconColor = "";
              if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme) {
                if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme?.default_state) {
                  if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme?.default_state?.icon_color) {
                    defaultThemeDefaultStateIconColor = variables.ulm_card_kepath_extra_templates_icon_appearance.default_theme.default_state.icon_color;
                  }
                }
              }
              return defaultThemeDefaultStateIconColor;
            ]]]
          background_color: >
            [[[
              var defaultThemeDefaultStateBGColor = "";
              if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme) {
                if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme?.default_state) {
                  if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme?.default_state?.background_color) {
                    defaultThemeDefaultStateBGColor = variables.ulm_card_kepath_extra_templates_icon_appearance.default_theme.default_state.background_color;
                  }
                }
              }
              return defaultThemeDefaultStateBGColor;
            ]]]
        triggered_state:
          matching_state: >
            [[[
              var defaultThemeTriggeredStateMatchingState = "0";
              if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme) {
                if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme?.triggered_state) {
                  if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme?.triggered_state?.matching_state) {
                    defaultThemeTriggeredStateMatchingState = variables.ulm_card_kepath_extra_templates_icon_appearance.default_theme.triggered_state.matching_state;
                  }
                }
              }
              return defaultThemeTriggeredStateMatchingState;
            ]]]
          matching_type: >
            [[[
              var defaultThemeTriggeredStateMatchingType = "gt";
              if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme) {
                if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme?.triggered_state) {
                  if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme?.triggered_state?.matching_type) {
                    defaultThemeTriggeredStateMatchingType = variables.ulm_card_kepath_extra_templates_icon_appearance.default_theme.triggered_state.matching_type;
                  }
                }
              }
              return defaultThemeTriggeredStateMatchingType;
            ]]]
          icon: >
            [[[
              var defaultThemeTriggeredStateIcon = "";
              if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme) {
                if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme?.triggered_state) {
                  if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme?.triggered_state?.icon) {
                    defaultThemeTriggeredStateIcon = variables.ulm_card_kepath_extra_templates_icon_appearance.default_theme.triggered_state.icon;
                  }
                }
              }
              return defaultThemeTriggeredStateIcon;
            ]]]
          icon_color: >
            [[[
              var defaultThemeTriggeredStateIconColor = "";
              if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme) {
                if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme?.triggered_state) {
                  if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme?.triggered_state?.icon_color) {
                    defaultThemeTriggeredStateIconColor = variables.ulm_card_kepath_extra_templates_icon_appearance.default_theme.triggered_state.icon_color;
                  }
                }
              }
              return defaultThemeTriggeredStateIconColor;
            ]]]
          background_color: >
            [[[
              var defaultThemeTriggeredStateBGColor = "";
              if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme) {
                if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme?.triggered_state) {
                  if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.default_theme?.triggered_state?.background_color) {
                    defaultThemeTriggeredStateBGColor = variables.ulm_card_kepath_extra_templates_icon_appearance.default_theme.triggered_state.background_color;
                  }
                }
              }
              return defaultThemeTriggeredStateBGColor;
            ]]]
      dark_theme:
        default_state:
          icon: >
            [[[
              var darkThemeDefaultStateIcon = "";
              if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme) {
                if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme?.default_state) {
                  if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme?.default_state?.icon) {
                    darkThemeDefaultStateIcon = variables.ulm_card_kepath_extra_templates_icon_appearance.dark_theme.default_state.icon;
                  }
                }
              }
              return darkThemeDefaultStateIcon;
            ]]]
          icon_color: >
            [[[
              var darkThemeDefaultStateIconColor = "";
              if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme) {
                if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme?.default_state) {
                  if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme?.default_state?.icon_color) {
                    darkThemeDefaultStateIconColor = variables.ulm_card_kepath_extra_templates_icon_appearance.dark_theme.default_state.icon_color;
                  }
                }
              }
              return darkThemeDefaultStateIconColor;
            ]]]
          background_color: >
            [[[
              var darkThemeDefaultStateBGColor = "";
              if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme) {
                if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme?.default_state) {
                  if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme?.default_state?.background_color) {
                    darkThemeDefaultStateBGColor = variables.ulm_card_kepath_extra_templates_icon_appearance.dark_theme.default_state.background_color;
                  }
                }
              }
              return darkThemeDefaultStateBGColor;
            ]]]
        triggered_state:
          matching_state: >
            [[[
              var defaultThemeTriggeredStateMatchingState = "0";
              if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme) {
                if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme?.triggered_state) {
                  if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme?.triggered_state?.matching_state) {
                    defaultThemeTriggeredStateMatchingState = variables.ulm_card_kepath_extra_templates_icon_appearance.dark_theme.triggered_state.matching_state;
                  }
                }
              }
              return defaultThemeTriggeredStateMatchingState;
            ]]]
          matching_type: >
            [[[
              var defaultThemeTriggeredStateMatchingType = "gt";
              if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme) {
                if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme?.triggered_state) {
                  if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme?.triggered_state?.matching_type) {
                    defaultThemeTriggeredStateMatchingType = variables.ulm_card_kepath_extra_templates_icon_appearance.dark_theme.triggered_state.matching_type;
                  }
                }
              }
              return defaultThemeTriggeredStateMatchingType;
            ]]]
          icon: >
            [[[
              var darkThemeTriggeredStateIcon = "";
              if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme) {
                if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme?.triggered_state) {
                  if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme?.triggered_state?.icon) {
                    darkThemeTriggeredStateIcon = variables.ulm_card_kepath_extra_templates_icon_appearance.dark_theme.triggered_state.icon;
                  }
                }
              }
              return darkThemeTriggeredStateIcon;
            ]]]
          icon_color: >
            [[[
              var darkThemeTriggeredStateIconColor = "";
              if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme) {
                if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme?.triggered_state) {
                  if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme?.triggered_state?.icon_color) {
                    darkThemeTriggeredStateIconColor = variables.ulm_card_kepath_extra_templates_icon_appearance.dark_theme.triggered_state.icon_color;
                  }
                }
              }
              return darkThemeTriggeredStateIconColor;
            ]]]
          background_color: >
            [[[
              var darkThemeTriggeredStateBGColor = "";
              if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme) {
                if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme?.triggered_state) {
                  if (variables?.ulm_card_kepath_extra_templates_icon_appearance?.dark_theme?.triggered_state?.background_color) {
                    darkThemeTriggeredStateBGColor = variables.ulm_card_kepath_extra_templates_icon_appearance.dark_theme.triggered_state.background_color;
                  }
                }
              }
              return darkThemeTriggeredStateBGColor;
            ]]]


  show_name: false
  styles:
    card:
      - border-bottom-left-radius: "0px"
      - border-bottom-right-radius: "0px"
      - padding: "12px"
      - padding-bottom: "18px"
      - margin-bottom: >
          [[[
            var marginBottom = "-5px";
            if (entity.state == "on") {
              marginBottom = "-10px";
              if (hass.themes.darkMode) {
                marginBottom = "-6px";
              }
            }
            return marginBottom;
          ]]]
      - box-shadow: >
          [[[
            var boxShadow = "none";
            if (entity.state == "on") {
              boxShadow = "rgba(0, 0, 0, 0.16) 0px -4px 7px -1px";
            }
            return boxShadow;
          ]]]
      - background-color: >
          [[[
            var BGColor = "rgba(var(--color-theme),0)";
            if (entity.state == "on") {
              BGColor = "";
            }
            return BGColor;
          ]]]

custom_card_kepath_binary_sensor_tab_selector_input_switcher:
  tap_action:
    action: "fire-dom-event"
    browser_mod:
      service: "browser_mod.sequence"
      data:
        sequence:
          - service: "input_boolean.turn_off"
            data:
              entity_id: >
                [[[
                  const dropdown_list = variables.ulm_card_kepath_binary_sensor_tab_list;
                  for (let i = 0; i < dropdown_list.length; i++) {
                    if (dropdown_list[i] == entity.entity_id) {
                      dropdown_list.splice(i,1); //remove selected tab button
                    }
                  }
                  return dropdown_list;
                ]]]
          - service: "input_boolean.turn_on"
            data:
              entity_id: >
                [[[ return entity.entity_id ]]]
