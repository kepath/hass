---
device_kepath_dishwasher_state:
  variables:
    ulm_device_kepath_dishwasher_state:
      entity: >
        [[[
          var entity = entity?.entity_id;
          if (variables?.ulm_device_kepath_dishwasher_state) {
            if (variables?.ulm_device_kepath_dishwasher_state?.device_status) {
              entity = variables?.ulm_device_kepath_dishwasher_state?.device_status;
            }
          }

          return entity;
        ]]]
      device_progress: >
        [[[
          var deviceProgress = "";
          if (variables?.ulm_device_kepath_dishwasher_state) {
            if (variables?.ulm_device_kepath_dishwasher_state?.device_progress) {
              deviceProgress = variables?.ulm_device_kepath_dishwasher_state?.device_progress;
            }
          }

          return deviceProgress;
        ]]]
  state:
    - operator: "template"
      value: >
        [[[
          return (states[variables.ulm_device_kepath_dishwasher_state.entity].state.toLowerCase() == 'run' || states[variables.ulm_device_kepath_dishwasher_state.entity].state.toLowerCase() == 'finished')
        ]]]
      icon: >
        [[[
          //console.log(Math.abs(Date.now() - Date.parse('2024-04-27T00:43:51+00:00')) / 36e5);

          var icon = "mdi:dishwasher";
          var progress;
          var progressInt;
          if (variables.ulm_device_kepath_dishwasher_state.device_progress) {
            progressInt = parseInt(states[variables.ulm_device_kepath_dishwasher_state.device_progress].state);
          }
          if ((!isNaN(progressInt)) && (progressInt !== undefined)) {
            progress = Math.round((100 - progressInt)/10);
            icon = "mdi:numeric-" + progress + "-circle-outline";
          }
          return icon;
        ]]]
      styles:
        icon:
          - color: "rgba(var(--color-green),1)"
        img_cell:
          - background-color: "rgba(var(--color-green), 0.2)"
    - operator: "template"
      value: >
        [[[
          return (states[variables.ulm_device_kepath_dishwasher_state.entity].state.toLowerCase() == 'unknown' || states[variables.ulm_device_kepath_dishwasher_state.entity].state.toLowerCase() == 'unavailable')
        ]]]
      icon: "mdi:dishwasher-off"
      styles:
        icon:
          - color: "rgba(var(--color-red),1)"
        img_cell:
          - background-color: "rgba(var(--color-red), 0.2)"
    - operator: "default"
      icon: "mdi:dishwasher"
      styles:
        icon:
          - color: "rgba(var(--color-blue),1)"
        img_cell:
          - background-color: "rgba(var(--color-blue), 0.2)"
