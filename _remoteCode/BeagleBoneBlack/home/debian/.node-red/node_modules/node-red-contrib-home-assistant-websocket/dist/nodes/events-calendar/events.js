"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.startListeners = startListeners;
const inputErrorHandler_1 = require("../../common/errors/inputErrorHandler");
const Websocket_1 = require("../../homeAssistant/Websocket");
function startListeners(clientEvents, controller, homeAssistant, node, status) {
    const queueUpcomingCalendarEvents = async () => {
        await controller.queueUpcomingCalendarEvents().catch((e) => {
            const { error, statusMessage } = (0, inputErrorHandler_1.getErrorData)(e);
            status.setError(statusMessage);
            node.error(error);
        });
    };
    if (homeAssistant.isHomeAssistantRunning) {
        queueUpcomingCalendarEvents();
    }
    else {
        clientEvents.addListener(Websocket_1.ClientEvent.InitialConnectionReady, queueUpcomingCalendarEvents);
    }
}
