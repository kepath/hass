# sensor:
#   #get SNMP values
# - platform: snmp
#   name: 'VPN eth0 State SNMP Calc'
#   host: !secret vpn_router_rj45_ip
#   baseoid: 1.3.6.1.2.1.2.2.1.8.2
#   community: 'public'
#   version: '2c'
#   unit_of_measurement: 'state'
# - platform: snmp
#   name: 'VPN eth1 State SNMP Calc'
#   host: !secret vpn_router_rj45_ip
#   baseoid: 1.3.6.1.2.1.2.2.1.8.3
#   community: 'public'
#   version: '2c'
#   unit_of_measurement: 'state'
# - platform: snmp
#   name: 'VPN tun0 State SNMP Calc'
#   host: !secret vpn_router_rj45_ip
#   baseoid: 1.3.6.1.2.1.2.2.1.8.8
#   community: 'public'
#   version: '2c'
#   unit_of_measurement: 'state'
# - platform: snmp
#   name: 'VPN eth0 In Octets SNMP Calc'
#   host: !secret vpn_router_rj45_ip
#   baseoid: 1.3.6.1.2.1.2.2.1.10.2
#   community: 'public'
#   version: '2c'
#   unit_of_measurement: 'octets'
# - platform: snmp
#   name: 'VPN eth1 In Octets SNMP Calc'
#   host: !secret vpn_router_rj45_ip
#   baseoid: 1.3.6.1.2.1.2.2.1.10.3
#   community: 'public'
#   version: '2c'
#   unit_of_measurement: 'octets'
# - platform: snmp
#   name: 'VPN tun0 In Octets SNMP Calc'
#   host: !secret vpn_router_rj45_ip
#   baseoid: 1.3.6.1.2.1.2.2.1.10.8
#   community: 'public'
#   version: '2c'
#   unit_of_measurement: 'octets'
# - platform: snmp
#   name: 'VPN eth0 Out Octets SNMP Calc'
#   host: !secret vpn_router_rj45_ip
#   baseoid: 1.3.6.1.2.1.2.2.1.16.2
#   community: 'public'
#   version: '2c'
#   unit_of_measurement: 'octets'
# - platform: snmp
#   name: 'VPN eth1 Out Octets SNMP Calc'
#   host: !secret vpn_router_rj45_ip
#   baseoid: 1.3.6.1.2.1.2.2.1.16.3
#   community: 'public'
#   version: '2c'
#   unit_of_measurement: 'octets'
# - platform: snmp
#   name: 'VPN tun0 Out Octets SNMP Calc'
#   host: !secret vpn_router_rj45_ip
#   baseoid: 1.3.6.1.2.1.2.2.1.16.8
#   community: 'public'
#   version: '2c'
#   unit_of_measurement: 'octets'

# #create derivative values from network speed changes
# - platform: derivative
#   name: VPN eth0 In Octets per second SNMP Calc
#   source: sensor.vpn_eth0_in_octets_snmp_calc
#   unit_time: s
#   unit: B
# - platform: derivative
#   name: VPN eth1 In Octets per second SNMP Calc
#   source: sensor.vpn_eth1_in_octets_snmp_calc
#   unit_time: s
#   unit: B
# - platform: derivative
#   name: VPN tun0 In Octets per second SNMP Calc
#   source: sensor.vpn_tun0_in_octets_snmp_calc
#   unit_time: s
#   unit: B
# - platform: derivative
#   name: VPN eth0 Out Octets per second SNMP Calc
#   source: sensor.vpn_eth0_out_octets_snmp_calc
#   unit_time: s
#   unit: B
# - platform: derivative
#   name: VPN eth1 Out Octets per second SNMP Calc
#   source: sensor.vpn_eth1_out_octets_snmp_calc
#   unit_time: s
#   unit: B
# - platform: derivative
#   name: VPN tun0 Out Octets per second SNMP Calc
#   source: sensor.vpn_tun0_out_octets_snmp_calc
#   unit_time: s
#   unit: B

# #Make derivative values into Mbps
# - platform: template
#   sensors:
#     vpn_eth0_in_octets_snmp_mbps:
#       icon_template: mdi:lan-connect
#       value_template:  "{{ [((states('sensor.vpn_eth0_in_octets_per_second_snmp_calc')|float*8)/1000000)|round(2),0]|max }}"
#       unit_of_measurement: 'Mbps'
#       friendly_name: "VPN eth0 In Speed"
#       unique_id: vpn_eth0_in_mbps
#     vpn_eth0_out_octets_snmp_mbps:
#       icon_template: mdi:lan-connect
#       value_template:  "{{ [((states('sensor.vpn_eth0_out_octets_per_second_snmp_calc')|float*8)/1000000)|round(2),0]|max }}"
#       unit_of_measurement: 'Mbps'
#       friendly_name: "VPN eth0 Out Speed"
#       unique_id: vpn_eth0_out_mbps
#     vpn_eth1_in_octets_snmp_mbps:
#       icon_template: mdi:access-point-network to
#       value_template:  "{{ [((states('sensor.vpn_eth1_in_octets_per_second_snmp_calc')|float*8)/1000000)|round(2),0]|max }}"
#       unit_of_measurement: 'Mbps'
#       friendly_name: "VPN eth1 In Speed"
#       unique_id: vpn_eth1_in_mbps
#     vpn_eth1_out_octets_snmp_mbps:
#       icon_template: mdi:access-point-network
#       value_template:  "{{ [((states('sensor.vpn_eth1_out_octets_per_second_snmp_calc')|float*8)/1000000)|round(2),0]|max }}"
#       unit_of_measurement: 'Mbps'
#       friendly_name: "VPN eth1 Out Speed"
#       unique_id: vpn_eth1_out_mbps
#     vpn_tun0_in_octets_snmp_mbps:
#       icon_template: mdi:security
#       value_template:  "{{ [((states('sensor.vpn_tun0_in_octets_per_second_snmp_calc')|float*8)/1000000)|round(2),0]|max }}"
#       unit_of_measurement: 'Mbps'
#       friendly_name: "VPN tun0 In Speed"
#       unique_id: vpn_tun0_in_mbps
#     vpn_tun0_out_octets_snmp_mbps:
#       icon_template: mdi:security
#       value_template:  "{{ [((states('sensor.vpn_tun0_out_octets_per_second_snmp_calc')|float*8)/1000000)|round(2),0]|max }}"
#       unit_of_measurement: 'Mbps'
#       friendly_name: "VPN tun0 Out Speed"
#       unique_id: vpn_tun0_out_mbps

# #create statistics from the Mbps values
# - platform: statistics
#   entity_id: sensor.vpn_eth0_in_octets_snmp_mbps
#   name: VPN eth0 In Octets Mbps Stats Calc
#   state_characteristic: mean
#   sampling_size: 300 #minimum 10 minutes
#   max_age: 
#     hours: 24
# - platform: statistics
#   entity_id: sensor.vpn_eth0_out_octets_snmp_mbps
#   name: VPN eth0 Out Octets Mbps Stats Calc
#   state_characteristic: mean
#   sampling_size: 300 #minimum 10 minutes
#   max_age: 
#     hours: 24
# - platform: statistics
#   entity_id: sensor.vpn_eth1_in_octets_snmp_mbps
#   name: VPN eth1 In Octets Mbps Stats Calc
#   state_characteristic: mean
#   sampling_size: 300 #minimum 10 minutes
#   max_age: 
#     hours: 24
# - platform: statistics
#   entity_id: sensor.vpn_eth1_out_octets_snmp_mbps
#   name: VPN eth1 Out Octets Mbps Stats Calc
#   state_characteristic: mean
#   sampling_size: 300 #minimum 10 minutes
#   max_age: 
#     hours: 24
# - platform: statistics
#   entity_id: sensor.vpn_tun0_in_octets_snmp_mbps
#   name: VPN tun0 In Octets Mbps Stats Calc
#   state_characteristic: mean
#   sampling_size: 300 #minimum 10 minutes
#   max_age: 
#     hours: 24
# - platform: statistics
#   entity_id: sensor.vpn_tun0_out_octets_snmp_mbps
#   name: VPN tun0 Out Octets Mbps Stats Calc
#   state_characteristic: mean
#   sampling_size: 300 #minimum 10 minutes
#   max_age: 
#     hours: 24


# #extract max value from stats  
# - platform: template
#   sensors:
#     vpn_eth0_in_octets_snmp_mbps_max:
#       value_template: >-
#         {% if states('sensor.vpn_eth0_in_octets_mbps_stats_calc') == 'unknown' or 
#         states('sensor.vpn_eth0_in_octets_mbps_stats_calc') == 'unavailable' %}
#           {{ 0 }}
#         {% else %}
#           {{ state_attr('sensor.vpn_eth0_in_octets_mbps_stats_calc', 'max_value') }}
#         {% endif %}
#       friendly_name: VPN eth0 Max Mbps In Last 24 Hours
#       unique_id: vpn_eth0_in_mbps_max
#       unit_of_measurement: 'Mbps'
#       icon_template: mdi:speedometer
# - platform: template
#   sensors:
#     vpn_eth0_out_octets_snmp_mbps_max:
#       value_template: >-
#         {% if states('sensor.vpn_eth0_out_octets_mbps_stats_calc') == 'unknown' or 
#         states('sensor.vpn_eth0_out_octets_mbps_stats_calc') == 'unavailable' %}
#           {{ 0 }}
#         {% else %}
#           {{ state_attr('sensor.vpn_eth0_out_octets_mbps_stats_calc', 'max_value') }}
#         {% endif %}
#       friendly_name: VPN eth0 Max Mbps Out Last 24 Hours
#       unique_id: vpn_eth0_out_mbps_max
#       unit_of_measurement: 'Mbps'
#       icon_template: mdi:speedometer
# - platform: template
#   sensors:
#     vpn_eth1_in_octets_snmp_mbps_max:
#       value_template: >-
#         {% if states('sensor.vpn_eth1_in_octets_mbps_stats_calc') == 'unknown' or 
#         states('sensor.vpn_eth1_in_octets_mbps_stats_calc') == 'unavailable' %}
#           {{ 0 }}
#         {% else %}
#           {{ state_attr('sensor.vpn_eth1_in_octets_mbps_stats_calc', 'max_value') }}
#         {% endif %}
#       friendly_name: VPN eth1 Max Mbps In Last 24 Hours
#       unique_id: vpn_eth1_in_mbps_max
#       unit_of_measurement: 'Mbps'
#       icon_template: mdi:speedometer
# - platform: template
#   sensors:
#     vpn_eth1_out_octets_snmp_mbps_max:
#       value_template: >-
#         {% if states('sensor.vpn_eth1_out_octets_mbps_stats_calc') == 'unknown' or 
#         states('sensor.vpn_eth1_out_octets_mbps_stats_calc') == 'unavailable' %}
#           {{ 0 }}
#         {% else %}
#           {{ state_attr('sensor.vpn_eth1_out_octets_mbps_stats_calc', 'max_value') }}
#         {% endif %}
#       friendly_name: VPN eth1 Max Mbps Out Last 24 Hours
#       unique_id: vpn_eth1_out_mbps_max
#       unit_of_measurement: 'Mbps'
#       icon_template: mdi:speedometer
# - platform: template
#   sensors:
#     vpn_tun0_in_octets_snmp_mbps_max:
#       value_template: >-
#         {% if states('sensor.vpn_tun0_in_octets_mbps_stats_calc') == 'unknown' or 
#         states('sensor.vpn_tun0_in_octets_mbps_stats_calc') == 'unavailable' %}
#           {{ 0 }}
#         {% else %}
#           {{ state_attr('sensor.vpn_tun0_in_octets_mbps_stats_calc', 'max_value') }}
#         {% endif %}
#       friendly_name: VPN tun0 Max Mbps In Last 24 Hours
#       unique_id: vpn_tun0_in_mbps_max
#       unit_of_measurement: 'Mbps'
#       icon_template: mdi:speedometer
# - platform: template
#   sensors:
#     vpn_tun0_out_octets_snmp_mbps_max:
#       value_template: >-
#         {% if states('sensor.vpn_tun0_out_octets_mbps_stats_calc') == 'unknown' or 
#         states('sensor.vpn_tun0_out_octets_mbps_stats_calc') == 'unavailable' %}
#           {{ 0 }}
#         {% else %}
#           {{ state_attr('sensor.vpn_tun0_out_octets_mbps_stats_calc', 'max_value') }}
#         {% endif %}
#       friendly_name: VPN tun0 Max Mbps Out Last 24 Hours
#       unique_id: vpn_tun0_out_mbps_max
#       unit_of_measurement: 'Mbps'
#       icon_template: mdi:speedometer


# #get SNMP values for processor load
# - platform: snmp
#   name: 'VPN Load 1 Calc'
#   host: !secret vpn_router_rj45_ip
#   baseoid: 1.3.6.1.4.1.2021.10.1.5.1
#   community: 'public'
#   version: '2c'
# #  unit_of_measurement: 'calc'
#   value_template: "{{ is_state('value' , 0) / 100}}"
# - platform: snmp
#   name: 'VPN Load 5 Calc'
#   host: !secret vpn_router_rj45_ip
#   baseoid: 1.3.6.1.4.1.2021.10.1.5.2
#   community: 'public'
#   version: '2c'  
# #  unit_of_measurement: 'calc'
#   value_template: "{{ is_state('value' , 0) / 100}}"
# - platform: snmp
#   name: 'VPN Load 15 Calc'
#   host: !secret vpn_router_rj45_ip
#   baseoid: 1.3.6.1.4.1.2021.10.1.5.3
#   community: 'public'
#   version: '2c'
# #  unit_of_measurement: 'calc'
#   value_template: "{{ is_state('value' , 0) / 100}}"

# - platform: derivative
#   name: 'VPN Load Over 1 min/second'
#   source: sensor.vpn_load_1_calc
#   unit_time: s
#   unit: "%"
# - platform: derivative
#   name: 'VPN Load Over 5 min/second'
#   source: sensor.vpn_load_5_calc
#   unit_time: s
#   unit: "%"
# - platform: derivative
#   name: 'VPN Load Over 15 min/second'
#   source: sensor.vpn_load_15_calc
#   unit_time: s
#   unit: "%"

# binary_sensor:
#   - platform: template
#     sensors:
#       vpn_eth0_up:
#         device_class: connectivity
#         friendly_name: "VPN eth0 up"
#         unique_id: vpn_eth0_status
#         value_template: "{{ is_state('sensor.vpn_eth0_state_snmp_calc', '1') }}"
#         icon_template: mdi:lan-connect
#   - platform: template
#     sensors:
#       vpn_eth1_up:
#         device_class: connectivity
#         friendly_name: "VPN eth1 up"
#         unique_id: vpn_eth1_status
#         value_template: "{{ is_state('sensor.vpn_eth1_state_snmp_calc', '1') }}"
#         icon_template: mdi:access-point-network
#   - platform: template
#     sensors:
#       vpn_tun0_up:
#         device_class: connectivity
#         friendly_name: "VPN tun0 up"
#         unique_id: vpn_tun0_status
#         value_template: "{{ is_state('sensor.vpn_tun0_state_snmp_calc', '1') }}"
#         icon_template: mdi:security

#   #OpenWRT Connections
#   - platform: template
#     sensors:
#       devicetracker_vpn_dpc:
#         device_class: connectivity
#         friendly_name: "Download PC On"
#         unique_id: devicetracker_vpn_dpc
#         value_template: "{{ is_state('device_tracker.dpc', 'home') }}"
#         icon_template: mdi:download-network
#   - platform: template
#     sensors:
#       devicetracker_vpn_diskstation:
#         device_class: connectivity
#         friendly_name: "Diskstation connected to VPN"
#         unique_id: devicetracker_vpn_diskstation
#         value_template: "{{ is_state('device_tracker.diskstation_2', 'home') }}"
#         icon_template: mdi:server-network