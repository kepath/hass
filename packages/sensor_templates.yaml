---
template:
  - sensor:
      - unique_id: "binary_sensor_state_counts_template_generated"
        name: "binary_sensor_state_counts"
        state: "{{ expand('group.all_updates')|selectattr('state', 'eq', 'on')|list|count }}"
        attributes:
          area_bottom_floor_security_sensors_triggered_count: "{{ expand('group.all_bottom_floor_area_security_device_class_binary_sensors')|selectattr('state','eq', 'on')|list|count }}"
          area_bottom_floor_security_sensors_unavailable_count: "{{ expand('group.all_bottom_floor_area_security_device_class_binary_sensors')|selectattr('state','in', ['unavailable','unknown'])|list|count }}"
          area_middle_floor_security_sensors_triggered_count: "{{ expand('group.all_middle_floor_area_security_device_class_binary_sensors')|selectattr('state','eq', 'on')|list|count }}"
          area_middle_floor_security_sensors_unavailable_count: "{{ expand('group.all_middle_floor_area_security_device_class_binary_sensors')|selectattr('state','in', ['unavailable','unknown'])|list|count }}"
          area_top_floor_security_sensors_triggered_count: "{{ expand('group.all_top_floor_area_security_device_class_binary_sensors')|selectattr('state','eq', 'on')|list|count }}"
          area_top_floor_security_sensors_unavailable_count: "{{ expand('group.all_top_floor_area_security_device_class_binary_sensors')|selectattr('state','in', ['unavailable','unknown'])|list|count }}"
          batteries_below20_count: "{{expand('group.all_battery_class_sensors')|map(attribute='state')|map('int',50)|select('lt',20)|list|count}}"
          batteries_unavailable_count: "{{ expand('group.all_battery_class_sensors')|selectattr('state','in', ['unavailable','unknown'])|list|count }}"
          batteries_average_value: "{{expand('group.all_battery_class_sensors')|map(attribute='state')|reject('undefined')|map('int',50)|list|average|round(-1)|int(0)}}"
          cameras_off_count: "{{ expand('group.all_cameras')|rejectattr('state','in', ['recording','idle'])|list|count }}"
          cameras_unavailable_count: "{{ expand('group.all_cameras')|selectattr('state','in', ['unavailable','unknown'])|list|count }}"
          climate_devices_on_count: >
            {{
              [(expand('group.all_climate')|map(attribute='entity_id')|select('is_state_attr', 'hvac_action', 'heating')|list|count),
              (expand('group.all_climate')|rejectattr('attributes.hvac_action', 'defined')|selectattr('state', 'in', ['heat','on'])|list|count),
              (( 0 if (states('sensor.air_to_water_heat_pump_out_water_temperature')|round < 45) else 1) if (has_value('sensor.air_to_water_heat_pump_out_water_temperature')) else 0 )]|sum
            }}
          connectivity_disconnected_count: "{{ expand('group.all_connectivity_class_binary_sensors')|selectattr('state','eq', 'off')|list|count }}"
          connectivity_unavailable_count: "{{ expand('group.all_connectivity_class_binary_sensors')|selectattr('state','in', ['unavailable','unknown'])|list|count }}"
          data_rate_unavailable_count: "{{ expand('group.all_data_rate_class_sensors')|selectattr('state','in', ['unavailable','unknown'])|list|count }}"
          data_rate_total_count: "{{expand('group.all_measured_data_rate_class_sensors')|map(attribute='state')|reject('in',['none','unknown','unavailable'])|select('is_number')|list|count}}"
          data_rate_total_value: "{{expand('group.all_measured_data_rate_class_sensors')|map(attribute='state')|reject('in',['none','unknown','unavailable'])|select('is_number')|map('float', '0.0')|sum|round()}}"
          data_rate_total_value_10_times_smaller: "{{(state_attr('sensor.binary_sensor_state_counts', 'data_rate_total_value') / 10)|round()}}"
          data_rate_total_average: "{{ (state_attr('sensor.binary_sensor_state_counts', 'data_rate_total_value') / state_attr('sensor.binary_sensor_state_counts', 'data_rate_total_count'))|round(2) }}"
          data_rate_total_average_10_times_larger: "{{(state_attr('sensor.binary_sensor_state_counts', 'data_rate_total_average') * 10)|round()}}"
          device_trackers_away_count: "{{ expand('group.all_device_trackers')|selectattr('state','in', ['away','not_home'])|list|count }}"
          device_trackers_unavailable_count: "{{ expand('group.all_device_trackers')|selectattr('state','in', ['unavailable','unknown'])|list|count }}"
          door_sensors_triggered_count: "{{ expand('group.all_door_class_binary_sensors')|selectattr('state','eq', 'on')|list|count }}"
          door_sensors_unavailable_count: "{{ expand('group.all_door_class_binary_sensors')|selectattr('state','in', ['unavailable','unknown'])|list|count }}"
          hacs_updates_available: "{{ expand('group.all_updates')|selectattr('state','eq', 'on')|map(attribute='entity_id')|map('device_attr', 'identifiers')|map('first')|select('defined')|map('first')|select('eq', 'hacs')|list|count }}"
          integration_icloud3_unavailable_count: >
            {{
              states|selectattr('state','in',['unavailable','unknown'])|
              rejectattr('domain','in',['button','event','conversation','stt','tts','wake_word'])|map(attribute='entity_id')|
              map('device_attr','identifiers')|reject('none')|map('first')|select('defined')|map('first')|select('defined')|
              select('eq', 'icloud3')|list|count
            }}
          integration_nest_protect_unavailable_count: >
            {{
              states|selectattr('state','in',['unavailable','unknown'])|
              rejectattr('domain','in',['button','event','conversation','stt','tts','wake_word'])|map(attribute='entity_id')|
              map('device_attr','identifiers')|reject('none')|map('first')|select('defined')|map('first')|select('defined')|
              select('eq', 'nest_protect')|list|count
            }}
          integration_mass_unavailable_count: >
            {{
              states|selectattr('state','in',['unavailable','unknown'])|
              rejectattr('domain','in',['button','event','conversation','stt','tts','wake_word'])|map(attribute='entity_id')|
              map('device_attr','identifiers')|reject('none')|map('first')|select('defined')|map('first')|select('defined')|
              select('eq', 'mass')|list|count
            }}
          integration_spook_unavailable_count: >
            {{
              states|selectattr('state','in',['unavailable','unknown'])|
              rejectattr('domain','in',['button','event','conversation','stt','tts','wake_word'])|map(attribute='entity_id')|
              map('device_attr','identifiers')|reject('none')|map('first')|select('defined')|map('first')|select('defined')|
              select('eq', 'spook')|list|count
            }}
          integration_synology_dsm_unavailable_count: >
            {{
              states|selectattr('state','in',['unavailable','unknown'])|
              rejectattr('domain','in',['button','event','conversation','stt','tts','wake_word'])|map(attribute='entity_id')|
              map('device_attr','identifiers')|reject('none')|map('first')|select('defined')|map('first')|select('defined')|
              select('eq', 'synology_dsm')|list|count
            }}
          integration_unifi_unavailable_count: >
            {{
              states|selectattr('state','in',['unavailable','unknown'])|
              rejectattr('domain','in',['button','event','conversation','stt','tts','wake_word'])|map(attribute='entity_id')|
              map('device_attr','identifiers')|reject('none')|map('first')|select('defined')|map('first')|select('defined')|
              select('eq', 'unifi')|list|count
            }}
          integration_unifiprotect_unavailable_count: >
            {{
              states|selectattr('state','in',['unavailable','unknown'])|
              rejectattr('domain','in',['button','event','conversation','stt','tts','wake_word'])|map(attribute='entity_id')|
              map('device_attr','identifiers')|reject('none')|map('first')|select('defined')|map('first')|select('defined')|
              select('eq', 'unifiprotect')|list|count
            }}
          integration_zha_unavailable_count: >
            {{
              states|selectattr('state','in',['unavailable','unknown'])|
              rejectattr('domain','in',['button','event','conversation','stt','tts','wake_word'])|map(attribute='entity_id')|
              map('device_attr','identifiers')|reject('none')|map('first')|select('defined')|map('first')|select('defined')|
              select('eq', 'zha')|list|count
            }}
          fans_on_count: "{{ expand('group.all_fans')|selectattr('state','eq', 'on')|list|count }}"
          fans_unavailable_count: "{{ expand('group.all_fans')|selectattr('state','in', ['unavailable','unknown'])|list|count }}"
          lawn_mower_busy_count: "{{ expand('group.all_lawn_mowers')|selectattr('state','in', ['on','mowing','edgecut'])|list|count }}"
          lawn_mower_error_count: "{{ expand('group.all_lawn_mowers')|rejectattr('state','in', ['on','mowing','edgecut','docked','returning','starting','rain_delay'])|list|count }}"
          lights_on_count: "{{ expand('group.all_lights')|selectattr('state','eq', 'on')|list|count }}"
          locks_unavailable_count: "{{ expand('group.all_locks')|selectattr('state','in', ['unavailable','unknown','jammed'])|list|count }}"
          locks_unlocked_count: "{{ expand('group.all_locks')|selectattr('state','eq', 'unlocked')|list|count }}"
          media_player_audio_on_count: "{{ expand('group.all_audio_class_media_player')|rejectattr('state','in', ['unavailable','unknown','standby','idle','off'])|list|count }}"
          media_player_audio_unavailable_count: "{{ expand('group.all_audio_class_media_player')|selectattr('state','in', ['unavailable','unknown'])|list|count }}"
          media_player_tv_and_remote_on_count: "{{ expand('group.all_remotes_and_tv_class_media_player')|rejectattr('state','in', ['unavailable','unknown','standby','idle','off'])|list|count }}"
          media_player_tv_and_remote_unavailable_count: "{{ expand('group.all_remotes_and_tv_class_media_player')|selectattr('state','in', ['unavailable','unknown'])|list|count }}"
          nest_smoke_alert_on_count: "{{ expand('group.all_safety_class_binary_sensors')|selectattr('attributes.device_class', 'eq', 'smoke')|selectattr('state', 'eq', 'on')|list|count }}"
          nest_carbon_monoxide_alert_on_count: "{{ expand('group.all_safety_class_binary_sensors')|selectattr('attributes.device_class', 'eq', 'carbon_monoxide')|selectattr('state', 'eq', 'on')|list|count }}"
          nest_heat_alert_on_count: "{{ expand('group.all_safety_class_binary_sensors')|selectattr('attributes.device_class', 'eq', 'heat')|selectattr('state', 'eq', 'on')|list|count }}"
          occupancy_persons_home_count: "{{ expand(states.person)|selectattr('state','eq','home')|map(attribute='entity_id')|reject('eq','person.tablet')|list|count }}"
          occupancy_sensors_triggered_count: "{{ expand('group.all_occupancy_class_binary_sensors')|selectattr('state','eq', 'on')|list|count }}"
          occupancy_sensors_unavailable_count: "{{ expand('group.all_occupancy_class_binary_sensors')|selectattr('state','in', ['unavailable','unknown'])|list|count }}"
          occupancy_sensors_triggered_away_count: "{{ expand('group.all_away_occupancy_class_binary_sensors')|selectattr('state','eq', 'on')|list|count }}"
          occupancy_sensors_unavailable_away_count: "{{ expand('group.all_away_occupancy_class_binary_sensors')|selectattr('state','in', ['unavailable','unknown'])|list|count }}"
          plugs_off_count: "{{ expand('group.all_outlet_class_switch')|selectattr('state','eq', 'off')|list|count }}"
          running_stopped_count: "{{ expand('group.all_running_class_binary_sensors')|selectattr('state','eq', 'off')|list|count }}"
          running_unavailable_count: "{{ expand('group.all_running_class_binary_sensors')|selectattr('state','in', ['unavailable','unknown'])|list|count }}"
          safety_sensors_triggered_count: "{{ expand('group.all_safety_class_binary_sensors')|selectattr('state','eq', 'on')|list|count }}"
          safety_sensors_unavailable_count: "{{ expand('group.all_safety_class_binary_sensors')|selectattr('state','in', ['unavailable','unknown'])|list|count }}"
          signal_sensors_low_count: "{{expand('group.all_signal_strength_class_sensors')|map(attribute='state')|map('int',0)|select('lt',-80)|list|count}}"
          signal_sensors_unavailable_count: "{{ expand('group.all_signal_strength_class_sensors')|selectattr('state','in', ['unavailable','unknown'])|list|count }}"
          signal_sensors_average_value: "{{expand('group.all_signal_strength_class_sensors')|map(attribute='state')|reject('undefined')|reject('in',['unavailable','unknown'])|map('int',0)|list|average|int(0)}}"
          tab_action_sensors_triggered_count: >
            {{
              [
                state_attr('sensor.binary_sensor_state_counts', 'lights_on_count')|int(0),
                state_attr('sensor.binary_sensor_state_counts', 'fans_on_count')|int(0),
                state_attr('sensor.binary_sensor_state_counts', 'climate_devices_on_count')|int(0),
                state_attr('sensor.binary_sensor_state_counts', 'lawn_mower_busy_count')|int(0),
                1 if (states('binary_sensor.washing_machine_is_active')|lower == 'on') else 0,
                1 if (states('binary_sensor.is_tumble_dryer_on')|lower == 'on') else 0,
                1 if (states('binary_sensor.is_dishwasher_on')|lower == 'on') else 0,
                1 if (states('switch.drinks_fridge_plug_bed_c')|lower == 'on') else 0,
                1 if (states('binary_sensor.yamaha_reciever_state')|lower == 'on') else 0,
                1 if (states('binary_sensor.is_arcade_pc_on')|lower == 'on') else 0,
                1 if (states('binary_sensor.is_big_pc_on')|lower == 'on') else 0,
              0]|sum
            }}
          tab_alert_sensors_triggered_count: >
            {{
              [
                state_attr('sensor.binary_sensor_state_counts', 'safety_sensors_triggered_count')|int(0),
                state_attr('sensor.binary_sensor_state_counts', 'locks_unlocked_count')|int(0),
                state_attr('sensor.binary_sensor_state_counts', 'cameras_off_count')|int(0),
                state_attr('sensor.binary_sensor_state_counts', 'door_sensors_triggered_count')|int(0),
                state_attr('sensor.binary_sensor_state_counts', 'occupancy_sensors_triggered_away_count')|int(0),
              0]|sum
            }}
          tab_information_sensors_triggered_count: >
            {{
              [
                state_attr('sensor.binary_sensor_state_counts', 'media_player_audio_on_count')|int(0),
                state_attr('sensor.binary_sensor_state_counts', 'media_player_tv_and_remote_on_count')|int(0),
              0]|sum
            }}
          tab_diagnostic_sensors_triggered_count: >
            {{
              [
                state_attr('sensor.binary_sensor_state_counts', 'device_trackers_away_count')|int(0),
                state_attr('sensor.binary_sensor_state_counts', 'connectivity_disconnected_count')|int(0),
                state_attr('sensor.binary_sensor_state_counts', 'running_stopped_count')|int(0),
                state_attr('sensor.binary_sensor_state_counts', 'batteries_below20_count')|int(0),
                state_attr('sensor.binary_sensor_state_counts', 'signal_sensors_low_count')|int(0),
                states('sensor.watchman_missing_entities')|int(0),
                states('sensor.active_issues')|int(0),
              0]|sum
            }}
          tab_update_sensors_triggered_count: >
            {{
              [
                states('sensor.binary_sensor_state_counts')|int(0),
              0]|sum
            }}
          unknown_value: "unknown"
          non_zero_value: "{{ 1|int }}"
          zero_value: "{{ 0|int }}"

      - unique_id: "integration_entity_attributes_template_generated"
        name: "Integration Entity Attributes"
        state: "0"
        attributes:
          domain_list: "{{ states|map(attribute='domain')|reject('undefined')|unique|list|sort}}"
          device_class_list: "{{ states|rejectattr('attributes.device_class', 'undefined')|map(attribute='attributes.device_class')|unique|list|sort }}"
          unit_of_measurement_list: "{{ states|rejectattr('attributes.unit_of_measurement', 'undefined')|map(attribute='attributes.unit_of_measurement')|unique|list|sort }}"
          integrations_installed_list: "{{ states|map(attribute='entity_id')|map('device_attr', 'identifiers')|reject('none')|map('first')|select('defined')|map(attribute='0')|unique|list|sort }}"
          integrations_with_unavailable_entities: "{{ states|selectattr('state','eq', 'unavailable')|map(attribute='entity_id')|map('device_attr', 'identifiers')|reject('none')|map('first')|select('defined')|map(attribute='0')|unique|list|sort }}"
          integrations_with_unknown_entities: "{{ states|selectattr('state','eq', 'unknown')|map(attribute='entity_id')|map('device_attr', 'identifiers')|reject('none')|map('first')|select('defined')|map(attribute='0')|unique|list|sort }}"


      - unique_id: "_unique_simple_state_printer"
        name: "Printer Simple State"
        state: >
          {{
            'error' if (
              states('sensor.mfc_j870dw_status')|lower|contains('jam') or
              states('sensor.mfc_j870dw_status')|lower|contains('replace') or
              states('sensor.mfc_j870dw_status')|lower|contains('cannot') or
              states('sensor.mfc_j870dw_status')|lower|contains('cover') or
              states('sensor.mfc_j870dw_status')|lower|contains('unable') or
              states('sensor.mfc_j870dw_status')|lower|contains('unusable') or
              states('sensor.mfc_j870dw_status')|lower|contains('wrong') or
              states('sensor.mfc_j870dw_status')|lower|contains('full'))
            else (
              'warning' if (not has_value('sensor.mfc_j870dw_status') or
              states('sensor.mfc_j870dw_status')|lower|contains('low'))
            else 'normal'
            )
          }}
        attributes:
          icon: "mdi:printer-alert"
          state_class: "measurement"

      - unique_id: "_unique_simple_state_nas"
        name: "DiskStation Simple State"
        state: >
          {{
            'error' if (
              states('sensor.diskstation_volume_1_status')|lower|contains('degrade') or
              states('sensor.diskstation_volume_1_status')|lower|contains('crash'))
            else (
              'normal' if (has_value('sensor.diskstation_volume_1_status') and
              states('sensor.diskstation_volume_1_status')|lower|contains('normal'))
            else 'warning'
            )
          }}
        attributes:
          icon: "mdi:nas"
          state_class: "measurement"

      - unique_id: "_unique_simple_state_ups"
        name: "UPS Simple State"
        state: >
          {{
            'warning' if (
              states('sensor.ups_status')|lower == 'online battery charging' or
              not has_value('sensor.ups_status'))
            else (
              'normal' if
              states('sensor.ups_status')|lower == 'online'
            else 'error'
            )
          }}
        attributes:
          icon: "mdi:battery-alert-variant"
          state_class: "measurement"

      - unique_id: "_unique_simple_state_front_door_lock"
        name: "Front Door Lock Simple State"
        state: >
          {{
            'warning' if (
              not has_value("lock.front_door_top_bolt") or
              not has_value("binary_sensor.lock_45f7_door")
            ) else (
              'locked' if (
                states('lock.front_door_top_bolt')|lower|contains('locked')
              ) else (
                'jammed' if (
                  states('lock.front_door_top_bolt')|lower|contains('jammed')
                ) else (
                  'door_open' if (
                    states("binary_sensor.lock_45f7_door") == 'on'
                  ) else (
                    'normal' if (
                      states('lock.front_door_top_bolt')|lower|contains('unlocked') and
                      (
                        now().hour < 21 or now().hour >= 7
                      ) and
                      state_attr("sensor.binary_sensor_state_counts", "occupancy_persons_home_count") > 0
                    ) else 'error'
                  )
                )
              )
            )
          }}
        attributes:
          icon: "mdi:lock-open-variant-outline"
          state_class: "measurement"

      - unique_id: "_unique_simple_state_all_occupancy_sensors"
        name: "All Occupancy Sensors Simple State"
        state: >
          {{
            'warning' if (
              not has_value("sensor.binary_sensor_state_counts")
            ) else (
              'not_triggered' if (
                  state_attr("sensor.binary_sensor_state_counts", "occupancy_sensors_triggered_count") == 0
              ) else (
                'triggered_home' if (
                  state_attr("sensor.binary_sensor_state_counts", "occupancy_persons_home_count") > 0 and
                  state_attr("sensor.binary_sensor_state_counts", "occupancy_sensors_triggered_count") > 0
                ) else (
                  'triggered_away' if (
                    state_attr("sensor.binary_sensor_state_counts", "occupancy_persons_home_count") == 0 and
                    state_attr("sensor.binary_sensor_state_counts", "occupancy_sensors_triggered_count") > 0
                  ) else 'error'
                )
              )
            )
          }}
        attributes:
          icon: "mdi:motion-sensor-off"
          state_class: "measurement"

      - unique_id: "_unique_simple_state_away_occupancy_sensors"
        name: "Internal Occupancy Sensors Simple State"
        state: >
          {{
            'warning' if (
              not has_value("sensor.binary_sensor_state_counts")
            ) else (
              'not_triggered' if (
                  state_attr("sensor.binary_sensor_state_counts", "occupancy_sensors_triggered_away_count") == 0
              ) else (
                'triggered_home' if (
                  state_attr("sensor.binary_sensor_state_counts", "occupancy_persons_home_count") > 0 and
                  state_attr("sensor.binary_sensor_state_counts", "occupancy_sensors_triggered_away_count") > 0
                ) else (
                  'triggered_away' if (
                    state_attr("sensor.binary_sensor_state_counts", "occupancy_persons_home_count") == 0 and
                    state_attr("sensor.binary_sensor_state_counts", "occupancy_sensors_triggered_away_count") > 0
                  ) else 'error'
                )
              )
            )
          }}
        attributes:
          icon: "mdi:motion-sensor"
          state_class: "measurement"

      - unique_id: "_unique_simple_state_washing_machine_sensors"
        name: "Washing Machine Sensor Simple State"
        state: >
          {{
            'warning' if (
              not has_value("input_datetime.washing_machine_instantaneous_demand_above_5w") or
              not has_value("input_datetime.washing_machine_instantaneous_demand_below_10w") or
              not has_value("input_datetime.washing_machine_instantaneous_demand_above_5w") or
              not has_value("input_datetime.washing_machine_instantaneous_demand_below_10w")
            ) else (
              'active' if (
                as_timestamp(states("input_datetime.washing_machine_instantaneous_demand_above_10w", now())) >
                as_timestamp(states("input_datetime.washing_machine_instantaneous_demand_below_10w", now()))
              ) else (
                'standby' if (
                  as_timestamp(states("input_datetime.washing_machine_instantaneous_demand_above_5w", now())) >
                  as_timestamp(states("input_datetime.washing_machine_instantaneous_demand_below_5w", now()))
                ) else 'off'
              )
            )
          }}
        attributes:
          icon: "mdi:washing-machine-alert"
          state_class: "measurement"

      - unique_id: "_unique_minimalist_ui_binary_action_sensors_tooltip"
        name: "minimalist_ui Binary Action Sensors Tooltip"
        state: >
          {{- state_attr('sensor.binary_sensor_state_counts', 'lights_on_count')|string if state_attr('sensor.binary_sensor_state_counts', 'lights_on_count')|int(0) > 0 -}}
          {{- ' light on,' if state_attr('sensor.binary_sensor_state_counts', 'lights_on_count')|int(0) == 1 -}}
          {{- ' lights on,' if state_attr('sensor.binary_sensor_state_counts', 'lights_on_count')|int(0) > 1 -}}
          {{- state_attr('sensor.binary_sensor_state_counts', 'fans_on_count')|string if state_attr('sensor.binary_sensor_state_counts', 'fans_on_count')|int(0) > 0 -}}
          {{- ' fan on,' if state_attr('sensor.binary_sensor_state_counts', 'fans_on_count')|int(0) == 1 -}}
          {{- ' fans on,' if state_attr('sensor.binary_sensor_state_counts', 'fans_on_count')|int(0) > 1 -}}
          {{- state_attr('sensor.binary_sensor_state_counts', 'climate_devices_on_count')|string if state_attr('sensor.binary_sensor_state_counts', 'climate_devices_on_count')|int(0) > 0 -}}
          {{- ' heat on,' if state_attr('sensor.binary_sensor_state_counts', 'climate_devices_on_count')|int(0) > 0 -}}
          {{- 'mower on,' if state_attr('sensor.binary_sensor_state_counts', 'lawn_mower_busy_count')|int(0) > 0 -}}
          {{- 'washer on,' if states('binary_sensor.washing_machine_is_active')|lower == 'on' -}}
          {{- 'dryer on,' if states('binary_sensor.is_tumble_dryer_on')|lower == 'on' -}}
          {{- 'dishwasher on,' if states('binary_sensor.is_dishwasher_on')|lower == 'on' -}}
          {{- 'fridge on,' if states('switch.drinks_fridge_plug_bed_c')|lower == 'on' -}}
          {{- 'reciever on,' if states('binary_sensor.yamaha_reciever_state')|lower == 'on' -}}
          {{- 'arcade pc on,' if states('binary_sensor.is_arcade_pc_on')|lower == 'on' -}}
          {{- 'bigpc on,' if states('binary_sensor.is_big_pc_on')|lower == 'on' -}}
        attributes:
          icon: "mdi:tooltip-question-outline"
          state_class: "measurement"

      - unique_id: "areas_and_entities_template_generated"
        name: "Areas Entity Attributes"
        state: "0"
        attributes:
          all_entities: "{{area_entities('All')}}"
          bathroom_entities: "{{area_entities('Bathroom')}}"
          bed_a_entities: "{{area_entities('Bed A')}}"
          bed_b_entities: "{{area_entities('Bed B')}}"
          bed_c_entities: "{{area_entities('Bed C')}}"
          bed_d_entities: "{{area_entities('Bed D')}}"
          bed_e_entities: "{{area_entities('Bed E')}}"
          external_back_entities: "{{area_entities('External: Back')}}"
          external_front_entities: "{{area_entities('External: Front')}}"
          garage_entities: "{{area_entities('Garage')}}"
          hallway_bottom_entities: "{{area_entities('Hallway, Bottom')}}"
          hallway_middle_entities: "{{area_entities('Hallway, Middle')}}"
          hallway_top_entities: "{{area_entities('Hallway, Top')}}"
          hass_internal_entities: "{{area_entities('HASS Internal')}}"
          kitchen_entities: "{{area_entities('Kitchen')}}"
          loft_entities: "{{area_entities('Loft')}}"
          lounge_entities: "{{area_entities('Lounge')}}"
          mobile_entities: "{{area_entities('Mobile')}}"
          retired_entities: "{{area_entities('Retired')}}"
          study_entities: "{{area_entities('Study')}}"
          unknown_device_entities: "{{area_entities('Unknown Device')}}"

      - unique_id: "floors_and_areas_and_entities_template_generated"
        name: "Floors Areas Entity Attributes"
        state: >-
          {%- for floor in floors() -%}
            {%- if floor!='house_and_mobile' -%}
              {%- for area in floor_areas(floor) -%}
                {%- for entity in area_entities(area) -%}
                  {{{
                    'floor': floor,
                    'area': area,
                    'entity': entity,
                  }}},
                {%- endfor -%}
              {%- endfor -%}
            {%- endif -%}
          {%- endfor %}

      - unique_id: "floor_grouped_areas_and_entities_template_generated"
        name: "Floor Grouped Areas Entity Attributes"
        state: "0"
        attributes:
          bottom_floor_entities: "{{area_entities('Kitchen')+area_entities('Lounge')+area_entities('Hallway, Bottom')+area_entities('Study')|sort}}"
          middle_floor_entities: "{{area_entities('Bed A')+area_entities('Bed B')+area_entities('Bed C')+area_entities('Hallway, Middle')+area_entities('Bathroom')|sort}}"
          top_floor_entities: "{{area_entities('Bed D')+area_entities('Bed E')+area_entities('Hallway, Top')|sort}}"
          loft_entities: "{{area_entities('Loft')|sort}}"
          external_entities: "{{area_entities('Garage')+area_entities('External: Back')+area_entities('External: Front')|sort}}"
          house_entities: "{{area_entities('All')+area_entities('HASS Internal')|sort}}"
          mobile_entities: "{{area_entities('Mobile')|sort}}"

      - unique_id: "_secrets_to_use_in_templates"
        name: "Non hard coded secrets to use in templates"
        state: "0"
        attributes:
          ha_nabucasa_url: !secret "ha_nabucasa_url"
          ha_rj45_ip: !secret "ha_rj45_ip"

      - unique_id: "calculated_non_count_entities_template_generated"
        name: "Calculated Non Count Entities"
        state: "0"
        attributes:
          middle_floor_nest_temperature: "{{ state_attr('climate.nest_middle_floor', 'current_temperature') }}"
          apple_maps_url_kev_location: >
            {{"https://maps.apple.com/place?ll=" + (state_attr('device_tracker.iphone_15_kev_icloud3', 'latitude') | string) + "," + (state_attr('device_tracker.iphone_15_kev_icloud3', 'longitude') | string)}}
          apple_maps_url_ju_location: >
            {{"https://maps.apple.com/place?ll=" + (state_attr('device_tracker.iphone_8_ju_icloud3', 'latitude') | string) + "," + (state_attr('device_tracker.iphone_8_ju_icloud3', 'longitude') | string)}}
          apple_maps_url_dan_location: >
            {{"https://maps.apple.com/place?ll=" + (state_attr('device_tracker.iphone_12_dan_icloud3', 'latitude') | string) + "," + (state_attr('device_tracker.iphone_12_dan_icloud3', 'longitude') | string)}}
          apple_maps_url_emily_location: >
            {{"https://maps.apple.com/place?ll=" + (state_attr('device_tracker.iphone_13_emily_patrice_icloud3', 'latitude') | string) + "," + (state_attr('device_tracker.iphone_13_emily_patrice_icloud3', 'longitude') | string)}}

      # Shelly Light Diagnotics
      - unique_id: "light_bathroom_shelly_diagnostics"
        name: "Bathroom Light Diagnostics"
        state: "{{ states('light.shelly_1l_bathroom_light_1') }}"
        attributes:
          icon: "{{ state_attr('light.shelly_1l_bathroom_light_1', 'icon') }}"
          connected: "{{ states('binary_sensor.shelly_1l_bathroom_light_status') }}"
          switch_1: "{{ states('binary_sensor.shelly_1l_bathroom_light_switch_1') }}"
          switch_2: "off"
          bssid: "{{ states('sensor.shelly_1l_bathroom_light_bssid') }}"
          essid: "{{ state_attr('device_tracker.esphome_shelly_1l_bathroom_light_unifi', 'essid') }}"
          esphome_version: "{{ states('sensor.shelly_1l_bathroom_light_esphome_version') }}"
          ip: "{{ states('sensor.shelly_1l_bathroom_light_ip') }}"
          mac: "{{ states('sensor.shelly_1l_bathroom_light_mac') }}"
          ap_mac: "{{ state_attr('device_tracker.esphome_shelly_1l_bathroom_light_unifi', 'ap_mac') }}"
          rssi: "{{ states('sensor.shelly_1l_bathroom_light_rssi') }}"
          ssid: "{{ states('sensor.shelly_1l_bathroom_light_ssid') }}"
          temperature: "{{ states('sensor.shelly_1l_bathroom_light_temperature') }}"
          firmware_installed: "{{ state_attr('update.shelly_1l_bathroom_light_firmware', 'installed_version') }}"

      - unique_id: "light_bed-a_shelly_diagnostics"
        name: "Bed A Light Diagnostics"
        state: "{{ states('light.shelly_1l_bed_a_light_1') }}"
        attributes:
          icon: "{{ state_attr('light.shelly_1l_bed_a_light_1', 'icon') }}"
          connected: "{{ states('binary_sensor.shelly_1l_bed_a_status') }}"
          switch_1: "{{ states('binary_sensor.bed_a_light_switch_1') }}"
          switch_2: "off"
          bssid: "{{ states('sensor.bed_a_light_bssid') }}"
          essid: "{{ state_attr('device_tracker.esphome_bed_a_light_unifi', 'essid') }}"
          esphome_version: "{{ states('sensor.bed_a_light_esphome_version') }}"
          ip: "{{ states('sensor.bed_a_light_ip') }}"
          mac: "{{ states('sensor.bed_a_light_mac') }}"
          ap_mac: "{{ state_attr('device_tracker.esphome_bed_a_light_unifi', 'ap_mac') }}"
          rssi: "{{ states('sensor.bed_a_light_rssi') }}"
          ssid: "{{ states('sensor.bed_a_light_ssid') }}"
          temperature: "{{ states('sensor.bed_a_light_temperature') }}"
          firmware_installed: "{{ state_attr('update.bed_a_light_firmware', 'installed_version') }}"

      - unique_id: "light_bed-b_shelly_diagnostics"
        name: "Bed B Light Diagnostics"
        state: "{{ states('light.shelly_1l_bed_b_light_1') }}"
        attributes:
          icon: "{{ state_attr('light.shelly_1l_bed_b_light_1', 'icon') }}"
          connected: "{{ states('binary_sensor.bed_b_light_status') }}"
          switch_1: "{{ states('binary_sensor.bed_b_light_switch_1') }}"
          switch_2: "off"
          bssid: "{{ states('sensor.bed_b_light_bssid') }}"
          essid: "{{ state_attr('device_tracker.esphome_bed_b_light_unifi', 'essid') }}"
          esphome_version: "{{ states('sensor.bed_b_light_esphome_version') }}"
          ip: "{{ states('sensor.bed_b_light_ip') }}"
          mac: "{{ states('sensor.bed_b_light_mac') }}"
          ap_mac: "{{ state_attr('device_tracker.esphome_bed_b_light_unifi', 'ap_mac') }}"
          rssi: "{{ states('sensor.bed_b_light_rssi') }}"
          ssid: "{{ states('sensor.bed_b_light_ssid') }}"
          temperature: "{{ states('sensor.bed_b_light_temperature') }}"
          firmware_installed: "{{ state_attr('update.bed_b_light_firmware', 'installed_version') }}"

      - unique_id: "light_bed-c_shelly_diagnostics"
        name: "Bed C Light Diagnostics"
        state: "{{ states('light.shelly_1l_bed_c_light_1') }}"
        attributes:
          icon: "{{ state_attr('light.shelly_1l_bed_c_light_1', 'icon') }}"
          connected: "{{ states('binary_sensor.shelly_1l_bed_c_light_status') }}"
          switch_1: "{{ states('binary_sensor.shelly_1l_bed_c_light_switch_1') }}"
          switch_2: "off"
          bssid: "{{ states('sensor.shelly_1l_bed_c_light_bssid') }}"
          essid: "{{ state_attr('device_tracker.esphome_shelly_1l_bed_c_light_unifi', 'essid') }}"
          esphome_version: "{{ states('sensor.shelly_1l_bed_c_light_esphome_version') }}"
          ip: "{{ states('sensor.shelly_1l_bed_c_light_ip') }}"
          mac: "{{ states('sensor.shelly_1l_bed_c_light_mac') }}"
          ap_mac: "{{ state_attr('device_tracker.esphome_shelly_1l_bed_c_light_unifi', 'ap_mac') }}"
          rssi: "{{ states('sensor.shelly_1l_bed_c_light_rssi') }}"
          ssid: "{{ states('sensor.shelly_1l_bed_c_light_ssid') }}"
          temperature: "{{ states('sensor.shelly_1l_bed_c_light_temperature') }}"
          firmware_installed: "{{ state_attr('update.shelly_1l_bed_c_light_firmware', 'installed_version') }}"

      - unique_id: "light_bed-e_shelly_diagnostics"
        name: "Bed E Light Diagnostics"
        state: "{{ states('light.shelly_1l_bed_e_light_1') }}"
        attributes:
          icon: "{{ state_attr('light.shelly_1l_bed_e_light_1', 'icon') }}"
          connected: "{{ states('binary_sensor.shelly_1l_bed_e_light_status') }}"
          switch_1: "{{ states('binary_sensor.shelly_1l_bed_e_light_switch_1') }}"
          switch_2: "off"
          bssid: "{{ states('sensor.shelly_1l_bed_e_light_bssid') }}"
          essid: "{{ state_attr('device_tracker.esphome_shelly_1l_bed_e_light_unifi', 'essid') }}"
          esphome_version: "{{ states('sensor.shelly_1l_bed_e_light_esphome_version') }}"
          ip: "{{ states('sensor.shelly_1l_bed_e_light_ip') }}"
          mac: "{{ states('sensor.shelly_1l_bed_e_light_mac') }}"
          ap_mac: "{{ state_attr('device_tracker.esphome_shelly_1l_bed_e_light_unifi', 'ap_mac') }}"
          rssi: "{{ states('sensor.shelly_1l_bed_e_light_rssi') }}"
          ssid: "{{ states('sensor.shelly_1l_bed_e_light_ssid') }}"
          temperature: "{{ states('sensor.shelly_1l_bed_e_light_temperature') }}"
          firmware_installed: "{{ state_attr('update.shelly_1l_bed_e_light_firmware', 'installed_version') }}"

      - unique_id: "light_ensuite_shelly_diagnostics"
        name: "En-suite Light Diagnostics"
        state: "{{ states('light.shelly_1l_ensuite_light_1') }}"
        attributes:
          icon: "{{ state_attr('light.shelly_1l_ensuite_light_1', 'icon') }}"
          connected: "{{ states('binary_sensor.shelly_1l_ensuite_light_status') }}"
          switch_1: "{{ states('binary_sensor.shelly_1l_ensuite_light_switch_1') }}"
          switch_2: "off"
          bssid: "{{ states('sensor.shelly_1l_ensuite_light_bssid') }}"
          essid: "{{ state_attr('device_tracker.esphome_shelly_1l_ensuite_light_unifi', 'essid') }}"
          esphome_version: "{{ states('sensor.shelly_1l_ensuite_light_esphome_version') }}"
          ip: "{{ states('sensor.shelly_1l_ensuite_light_ip') }}"
          mac: "{{ states('sensor.shelly_1l_ensuite_light_mac') }}"
          ap_mac: "{{ state_attr('device_tracker.esphome_shelly_1l_ensuite_light_unifi', 'ap_mac') }}"
          rssi: "{{ states('sensor.shelly_1l_ensuite_light_rssi') }}"
          ssid: "{{ states('sensor.shelly_1l_ensuite_light_ssid') }}"
          temperature: "{{ states('sensor.shelly_1l_ensuite_light_temperature') }}"
          firmware_installed: "{{ state_attr('update.shelly_1l_ensuite_light_firmware', 'installed_version') }}"

      - unique_id: "light_hallway-bottom_shelly_diagnostics"
        name: "Bottom Hallway Light Diagnostics"
        state: "{{ states('light.shelly_1l_hallway_bottom_light_1') }}"
        attributes:
          icon: "{{ state_attr('light.shelly_1l_hallway_bottom_light_1', 'icon') }}"
          connected: "{{ states('binary_sensor.shelly_1l_hallway_bottom_light_status') }}"
          switch_1: "{{ states('binary_sensor.shelly_1l_hallway_bottom_light_switch_1') }}"
          switch_2: "{{ states('binary_sensor.shelly_1l_hallway_bottom_light_switch_2') }}"
          bssid: "{{ states('sensor.shelly_1l_hallway_bottom_light_bssid') }}"
          essid: "{{ state_attr('device_tracker.esphome_shelly_1l_hallway_bottom_light_unifi', 'essid') }}"
          esphome_version: "{{ states('sensor.shelly_1l_hallway_bottom_light_esphome_version') }}"
          ip: "{{ states('sensor.shelly_1l_hallway_bottom_light_ip') }}"
          mac: "{{ states('sensor.shelly_1l_hallway_bottom_light_mac') }}"
          ap_mac: "{{ state_attr('device_tracker.esphome_shelly_1l_hallway_bottom_light_unifi', 'ap_mac') }}"
          rssi: "{{ states('sensor.shelly_1l_hallway_bottom_light_rssi') }}"
          ssid: "{{ states('sensor.shelly_1l_hallway_bottom_light_ssid') }}"
          temperature: "{{ states('sensor.shelly_1l_hallway_bottom_light_temperature') }}"
          firmware_installed: "{{ state_attr('update.shelly_1l_hallway_bottom_light_firmware', 'installed_version') }}"

      - unique_id: "light_kitchen-main_shelly_diagnostics"
        name: "Kitchen Main Light Diagnostics"
        state: "{{ states('light.shelly_1l_kitchen_main_light_1') }}"
        attributes:
          icon: "{{ state_attr('light.shelly_1l_kitchen_main_light_1', 'icon') }}"
          connected: "{{ states('binary_sensor.shelly_1l_kitchen_main_light_status') }}"
          switch_1: "{{ states('binary_sensor.shelly_1l_kitchen_main_light_switch_1') }}"
          switch_2: "off"
          bssid: "{{ states('sensor.shelly_1l_kitchen_main_light_bssid') }}"
          essid: "{{ state_attr('device_tracker.esphome_esphome_shelly_1l_kitchen_main_light_unifi', 'essid') }}"
          esphome_version: "{{ states('sensor.shelly_1l_kitchen_main_light_esphome_version') }}"
          ip: "{{ states('sensor.shelly_1l_kitchen_main_light_ip') }}"
          mac: "{{ states('sensor.shelly_1l_kitchen_main_light_mac') }}"
          ap_mac: "{{ state_attr('device_tracker.esphome_shelly_1l_kitchen_main_light_unifi', 'ap_mac') }}"
          rssi: "{{ states('sensor.shelly_1l_kitchen_main_light_rssi') }}"
          ssid: "{{ states('sensor.shelly_1l_kitchen_main_light_ssid') }}"
          temperature: "{{ states('sensor.shelly_1l_kitchen_main_light_temperature') }}"
          firmware_installed: "{{ state_attr('update.shelly_1l_kitchen_main_light_firmware', 'installed_version') }}"

      - unique_id: "light_kitchen-utility_shelly_diagnostics"
        name: "Kitchen Utility Light Diagnostics"
        state: "{{ states('light.shelly_1l_kitchen_utility_light_1') }}"
        attributes:
          icon: "{{ state_attr('light.shelly_1l_kitchen_utility_light_1', 'icon') }}"
          connected: "{{ states('binary_sensor.shelly_1l_kitchen_utility_light_status') }}"
          switch_1: "{{ states('binary_sensor.shelly_1l_kitchen_utility_light_switch_1') }}"
          switch_2: "{{ states('binary_sensor.shelly_1l_kitchen_utility_light_switch_2') }}"
          bssid: "{{ states('sensor.shelly_1l_kitchen_utility_light_bssid') }}"
          essid: "{{ state_attr('device_tracker.shelly_1l_kitchen_utility_light_unifi', 'essid') }}"
          esphome_version: "{{ states('sensor.esphome_shelly_1l_kitchen_utility_light_esphome_version') }}"
          ip: "{{ states('sensor.shelly_1l_kitchen_utility_light_ip') }}"
          mac: "{{ states('sensor.shelly_1l_kitchen_utility_light_mac') }}"
          ap_mac: "{{ state_attr('device_tracker.esphome_shelly_1l_kitchen_utility_light_unifi', 'ap_mac') }}"
          rssi: "{{ states('sensor.shelly_1l_kitchen_utility_light_rssi') }}"
          ssid: "{{ states('sensor.shelly_1l_kitchen_utility_light_ssid') }}"
          temperature: "{{ states('sensor.shelly_1l_kitchen_utility_light_temperature') }}"
          firmware_installed: "{{ state_attr('update.shelly_1l_kitchen_utility_light_firmware', 'installed_version') }}"

      - unique_id: "light_lounge_shelly_diagnostics"
        name: "Lounge Light Diagnostics"
        state: "{{ states('light.shelly_1l_lounge_light_1') }}"
        attributes:
          icon: "{{ state_attr('light.shelly_1l_lounge_light_1', 'icon') }}"
          connected: "{{ states('binary_sensor.shelly_1l_lounge_light_status') }}"
          switch_1: "{{ states('binary_sensor.shelly_1l_lounge_light_switch_1') }}"
          switch_2: "off"
          bssid: "{{ states('sensor.shelly_1l_lounge_light_bssid') }}"
          essid: "{{ state_attr('device_tracker.esphome_shelly_1l_lounge_light_unifi', 'essid') }}"
          esphome_version: "{{ states('sensor.shelly_1l_lounge_light_esphome_version') }}"
          ip: "{{ states('sensor.shelly_1l_lounge_light_ip') }}"
          mac: "{{ states('sensor.shelly_1l_lounge_light_mac') }}"
          ap_mac: "{{ state_attr('device_tracker.esphome_shelly_1l_lounge_light_unifi', 'ap_mac') }}"
          rssi: "{{ states('sensor.shelly_1l_lounge_light_rssi') }}"
          ssid: "{{ states('sensor.shelly_1l_lounge_light_ssid') }}"
          temperature: "{{ states('sensor.shelly_1l_lounge_light_temperature') }}"
          firmware_installed: "{{ state_attr('update.shelly_1l_lounge_light_firmware', 'installed_version') }}"

      - unique_id: "light_study_shelly_diagnostics"
        name: "Study Light Diagnostics"
        state: "{{ states('light.shelly_1l_study_light_1') }}"
        attributes:
          icon: "{{ state_attr('light.shelly_1l_study_light_1', 'icon') }}"
          connected: "{{ states('binary_sensor.shelly_1l_study_light_status') }}"
          switch_1: "{{ states('binary_sensor.shelly_1l_study_light_switch_1') }}"
          switch_2: "off"
          bssid: "{{ states('sensor.shelly_1l_study_light_bssid') }}"
          essid: "{{ state_attr('device_tracker.esphome_shelly_1l_study_light_unifi', 'essid') }}"
          esphome_version: "{{ states('sensor.shelly_1l_study_light_esphome_version') }}"
          ip: "{{ states('sensor.shelly_1l_study_light_ip') }}"
          mac: "{{ states('sensor.shelly_1l_study_light_mac') }}"
          ap_mac: "{{ state_attr('device_tracker.esphome_shelly_1l_study_light_unifi', 'ap_mac') }}"
          rssi: "{{ states('sensor.shelly_1l_study_light_rssi') }}"
          ssid: "{{ states('sensor.shelly_1l_study_light_ssid') }}"
          temperature: "{{ states('sensor.shelly_1l_study_light_temperature') }}"
          firmware_installed: "{{ state_attr('update.shelly_1l_study_light_firmware', 'installed_version') }}"

      - unique_id: "widgy_widgets_json_template_generated"
        name: "Widgy Widgets JSON"
        state: "0"
        attributes:
          bottom_hallway_light: >
            {{ "/local/widgy_widget_images/lights/bulb_1_on.png" if (states("light.shelly_1l_hallway_bottom_light_1") == "on") else "/local/widgy_widget_images/lights/bulb_1_off.png" }}
          lounge_light: >
            {{ "/local/widgy_widget_images/lights/chandelier_on.png" if (states("light.shelly_1l_lounge_light_1") == "on") else "/local/widgy_widget_images/lights/chandelier_off.png" }}
          study_light: >
            {{ "/local/widgy_widget_images/lights/light_1_on.png" if (states("light.shelly_1l_study_light_1") == "on") else "/local/widgy_widget_images/lights/light_1_off.png" }}
          kitchen_main_light: >
            {{ "/local/widgy_widget_images/lights/recessed_lights_on.png" if (states("light.shelly_1l_kitchen_main_light_1") == "on") else "/local/widgy_widget_images/lights/recessed_lights_off.png" }}
          kitchen_utility_light: >
            {{ "/local/widgy_widget_images/lights/light_1_on.png" if (states("light.shelly_1l_kitchen_utility_light_1") == "on") else "/local/widgy_widget_images/lights/light_1_off.png" }}
          middle_hallway_light: >
            {{ "/local/widgy_widget_images/lights/bulb_1_on.png" if (states("light.shelly_1l_hallway_bottom_light_1") == "on") else "/local/widgy_widget_images/lights/bulb_1_off.png" }}
          bathroom_light: >
            {{ "/local/widgy_widget_images/lights/recessed_lights_on.png" if (states("light.shelly_1l_bathroom_light_1") == "on") else "/local/widgy_widget_images/lights/recessed_lights_off.png" }}
          bed_a_light: >
            {{ "/local/widgy_widget_images/lights/light_2_on.png" if (states("light.shelly_1l_bed_a_light_1") == "on") else "/local/widgy_widget_images/lights/light_2_off.png" }}
          bed_a_ensuite_light: >
            {{ "/local/widgy_widget_images/lights/recessed_lights_on.png" if (states("light.shelly_1l_ensuite_light_1") == "on") else "/local/widgy_widget_images/lights/recessed_lights_off.png" }}
          bed_b_light: >
            {{ "/local/widgy_widget_images/lights/light_1_on.png" if (states("light.shelly_1l_bed_b_light_1") == "on") else "/local/widgy_widget_images/lights/light_1_off.png" }}
          bed_c_light: >
            {{ "/local/widgy_widget_images/lights/bulb_1_on.png" if (states("light.shelly_1l_bed_c_light_1") == "on") else "/local/widgy_widget_images/lights/bulb_1_off.png" }}
          bed_e_light: >
            {{ "/local/widgy_widget_images/lights/light_2_on.png" if (states("light.shelly_1l_bed_e_light_1") == "on") else "/local/widgy_widget_images/lights/light_2_off.png" }}
          bed_e_lamp: >
            {{ "/local/widgy_widget_images/lights/lamp_1_on.png" if (states("light.mss425e_6025_outlet_3") == "on") else "/local/widgy_widget_images/lights/lamp_1_off.png" }}
          bed_c_fan: >
            {{ "/local/widgy_widget_images/fans/fan_1_off.png"
              if (states('fan.bed_c_fan') == "off")
              else ("/local/widgy_widget_images/fans/fan_1_low.png" if state_attr('fan.bed_c_fan', 'percentage') < 50
              else "/local/widgy_widget_images/fans/fan_1_high.png"  ) }}
          bed_e_fan: >
            {{ "/local/widgy_widget_images/fans/fan_1_off.png"
              if (states('fan.bed_e_fan') == "off")
              else ("/local/widgy_widget_images/fans/fan_1_low.png" if state_attr('fan.bed_e_fan', 'percentage') < 50
              else "/local/widgy_widget_images/fans/fan_1_high.png"  ) }}
          front_door_lock: >
            {{ "/local/widgy_widget_images/locks/lock_1_closed.png" if (states("lock.front_door_top_bolt") == "locked") else "/local/widgy_widget_images/locks/lock_1_open.png" }}
          bottom_floor_nest_image: >
            {{ "/local/widgy_widget_images/climate/temperature_up.png" if (state_attr('climate.nest_bottom_floor', 'hvac_action') == "heat") else "/local/widgy_widget_images/climate/temperature_down.png" }}
          bottom_floor_nest_temperature: >
            {{ state_attr('climate.nest_bottom_floor', 'current_temperature') }}
          middle_floor_nest_image: >
            {{ "/local/widgy_widget_images/climate/temperature_up.png" if (state_attr('climate.nest_middle_floor', 'hvac_action') == "heat") else "/local/widgy_widget_images/climate/temperature_down.png" }}
          # security_alert_count: >
          #   {{ state_attr('sensor.binary_sensor_state_counts', 'occupancy_no_persons_home_triggered_count') }}
          persons_home_count: >
            {{ state_attr('sensor.binary_sensor_state_counts', 'occupancy_persons_home_count') }}
          nest_smoke_alert: >
            {{ expand('group.all_safety_class_binary_sensors')|selectattr('attributes.device_class', 'eq', 'smoke')|selectattr('state', 'eq', 'on')|list|count }}
          nest_carbon_monoxide_alert: >
            {{ expand('group.all_safety_class_binary_sensors')|selectattr('attributes.device_class', 'eq', 'carbon_monoxide')|selectattr('state', 'eq', 'on')|list|count }}
          nest_heat_alert: >
            {{ expand('group.all_safety_class_binary_sensors')|selectattr('attributes.device_class', 'eq', 'heat')|selectattr('state', 'eq', 'on')|list|count }}

      - unique_id: "floorplan_dates_template_generated"
        name: "Floorplan dates template generated"
        icon: >
          {% from 'easy_time.jinja' import clock_icon %}
          {{ clock_icon() }}
        state: >
          {% from 'easy_time.jinja' import clock %}
          {{ clock() }}
        attributes:
          front_door_last_opened: >
            {% from 'easy_time.jinja' import easy_relative_time %}
            {{ 'Unknown' if has_value(easy_relative_time('input_datetime.front_door_last_opened')) else easy_relative_time('input_datetime.front_door_last_opened') }}
          front_door_last_locked: >
            {% from 'easy_time.jinja' import easy_relative_time %}
            {{ 'Unknown' if has_value(easy_relative_time('input_datetime.front_door_last_locked')) else easy_relative_time('input_datetime.front_door_last_locked') }}
          back_door_last_opened: >
            {% from 'easy_time.jinja' import easy_relative_time %}
            {{ 'Unknown' if has_value(easy_relative_time('input_datetime.back_door_last_opened')) else easy_relative_time('input_datetime.back_door_last_opened') }}
          patio_door1_last_opened: >
            {% from 'easy_time.jinja' import easy_relative_time %}
            {{ 'Unknown' if has_value(easy_relative_time('input_datetime.patio_door1_last_opened')) else easy_relative_time('input_datetime.patio_door1_last_opened') }}
          patio_door2_last_opened: >
            {% from 'easy_time.jinja' import easy_relative_time %}
            {{ 'Unknown' if has_value(easy_relative_time('input_datetime.patio_door2_last_opened')) else easy_relative_time('input_datetime.patio_door2_last_opened') }}
          garage_door_last_opened: >
            {% from 'easy_time.jinja' import easy_relative_time %}
            {{ 'Unknown' if has_value(easy_relative_time('input_datetime.garage_door_last_opened')) else easy_relative_time('input_datetime.garage_door_last_opened') }}
          loft_ladder_last_opened: >
            {% from 'easy_time.jinja' import easy_relative_time %}
            {{ 'Unknown' if has_value(easy_relative_time('input_datetime.loft_ladder_last_opened')) else easy_relative_time('input_datetime.loft_ladder_last_opened') }}
          nest_protect_bottom_floor_last_activity: >
            {% from 'easy_time.jinja' import easy_relative_time %}
            {{ 'Unknown' if has_value(easy_relative_time('input_datetime.nest_protect_bottom_floor_last_activity')) else easy_relative_time('input_datetime.nest_protect_bottom_floor_last_activity') }}
          nest_protect_middle_floor_last_activity: >
            {% from 'easy_time.jinja' import easy_relative_time %}
            {{ 'Unknown' if has_value(easy_relative_time('input_datetime.nest_protect_middle_floor_last_activity')) else easy_relative_time('input_datetime.nest_protect_middle_floor_last_activity') }}
          nest_protect_top_floor_last_activity: >
            {% from 'easy_time.jinja' import easy_relative_time %}
            {{ 'Unknown' if has_value(easy_relative_time('input_datetime.nest_protect_top_floor_last_activity')) else easy_relative_time('input_datetime.nest_protect_top_floor_last_activity') }}
          motion_sensor_front_door_stairs_last_activity: >
            {% from 'easy_time.jinja' import easy_relative_time %}
            {{ 'Unknown' if has_value(easy_relative_time('input_datetime.motion_sensor_front_door_stairs_last_activity')) else easy_relative_time('input_datetime.motion_sensor_front_door_stairs_last_activity') }}
          motion_sensor_bed_e_last_activity: >
            {% from 'easy_time.jinja' import easy_relative_time %}
            {{ 'Unknown' if has_value(easy_relative_time('input_datetime.motion_sensor_bed_e_last_activity')) else easy_relative_time('input_datetime.motion_sensor_bed_e_last_activity') }}
          back_g3_flex_last_motion_detected: >
            {% from 'easy_time.jinja' import easy_relative_time %}
            {{ 'Unknown' if has_value(easy_relative_time('sensor.back_g3_flex_last_motion_detected')) else easy_relative_time('sensor.back_g3_flex_last_motion_detected') }}
          bed_c_g3_instant_last_motion_detected: >
            {% from 'easy_time.jinja' import easy_relative_time %}
            {{ 'Unknown' if has_value(easy_relative_time('sensor.bed_c_g3_instant_last_motion_detected')) else easy_relative_time('sensor.bed_c_g3_instant_last_motion_detected') }}
          bottom_hallway_g3_instant_last_motion_detected: >
            {% from 'easy_time.jinja' import easy_relative_time %}
            {{ 'Unknown' if has_value(easy_relative_time('sensor.bottom_hallway_g3_instant_last_motion_detected')) else easy_relative_time('sensor.bottom_hallway_g3_instant_last_motion_detected') }}
          doorbell_g4_last_doorbell_ring: >
            {% from 'easy_time.jinja' import easy_relative_time %}
            {{ 'Unknown' if has_value(easy_relative_time('sensor.doorbell_g4_last_doorbell_ring')) else easy_relative_time('sensor.doorbell_g4_last_doorbell_ring') }}
          front_g3_flex_last_motion_detected: >
            {% from 'easy_time.jinja' import easy_relative_time %}
            {{ 'Unknown' if has_value(easy_relative_time('sensor.front_g3_flex_last_motion_detected')) else easy_relative_time('sensor.front_g3_flex_last_motion_detected') }}
          kitchen_g3_instant_last_motion_detected: >
            {% from 'easy_time.jinja' import easy_relative_time %}
            {{ 'Unknown' if has_value(easy_relative_time('sensor.kitchen_g3_instant_last_motion_detected')) else easy_relative_time('sensor.kitchen_g3_instant_last_motion_detected') }}
          middle_hallway_g3_flex_last_motion_detected: >
            {% from 'easy_time.jinja' import easy_relative_time %}
            {{ 'Unknown' if has_value(easy_relative_time('sensor.middle_hallway_g3_flex_last_motion_detected')) else easy_relative_time('sensor.middle_hallway_g3_flex_last_motion_detected') }}
          clock_icon_color: >
            {% from 'easy_time.jinja' import clock_icon %}
            {% if clock_icon()=='mdi:clock-time-six' or  clock_icon()=='mdi:clock-time-twelve'%}
              red
            {% elif clock_icon()=='mdi:clock-time-seven' or  clock_icon()=='mdi:clock-time-one'%}
              pink
            {% elif clock_icon()=='mdi:clock-time-eight' or  clock_icon()=='mdi:clock-time-two'%}
              yellow
            {% elif clock_icon()=='mdi:clock-time-nine' or  clock_icon()=='mdi:clock-time-three'%}
              green
            {% elif clock_icon()=='mdi:clock-time-ten' or  clock_icon()=='mdi:clock-time-four'%}
              blue
            {% elif clock_icon()=='mdi:clock-time-eleven' or  clock_icon()=='mdi:clock-time-five'%}
              purple
            {% else %}
              theme
            {% endif %}
