sensor:
#  - platform: darksky
#    api_key: !secret dark_sky_api
#    hourly_forecast:
#      - 2
#    monitored_conditions:
#      - summary
#      - icon
#      - precip_type
#      - precip_intensity
#      - precip_probability
#      - precip_accumulation
#      - temperature
#      - apparent_temperature
#      - dew_point
#      - wind_speed
#      - wind_gust
#      - wind_bearing
#      - cloud_cover
#      - humidity
#      - pressure
#      - visibility
#      - ozone
#      - minutely_summary
#      - hourly_summary
#      - daily_summary
#      - temperature_high
#      - temperature_low
#      - apparent_temperature_high
#      - apparent_temperature_low
#      - precip_intensity_max
#      - uv_index
#      - moon_phase
#      - sunrise_time
#      - sunset_time
#      - nearest_storm_distance
#      - nearest_storm_bearing
#      - alerts

  # Own public IPv4 address
  - platform: dnsip
    name: WAN IP

#     # Kevs Phone to Home
#   - platform: google_travel_time
#     name: Travel Time Kevs Location To Home
# #    unique_id: travel_time_kev_to_home
#     api_key: !secret google_distance_matrix_api_key
#     origin: person.kevin_thorn
#     destination: zone.home
#     scan_interval: 1200

#     # Home to Tudor
#   - platform: google_travel_time
#     name: Travel Time Home To Tudor Hall
# #    unique_id: travel_time_home_to_tudor_hall
#     api_key: !secret google_distance_matrix_api_key
#     origin: zone.home
#     destination: zone.tudor_hall_school
#     scan_interval: 1200

#     # Home to Bloxham
#   - platform: google_travel_time
#     name: Travel Time Home To Bloxham
# #    unique_id: travel_time_home_to_bloxham_school
#     api_key: !secret google_distance_matrix_api_key
#     origin: zone.home
#     destination: zone.bloxham_school
#     scan_interval: 600

  - platform: launch_library

  - platform: feedparser
    name: RSS Hass Alerts
    feed_url: 'https://alerts.home-assistant.io/feed.xml'
    date_format: '%a, %b %d %I:%M %p'
    inclusions:
      - title
      - link
      - description
      - image
      - language
      - pubDate
    exclusions:
      - language

#  - platform: opensky
#    radius: 10

  - platform: tautulli
    name: Plex State Tautulli
    host: !secret ha_rj45_ip
    api_key: !secret tautulli_api_key

  - platform: mqtt
    name: Plex State MQTT
    state_topic: homeassistant/sensor/tautulli/all
    value_template: '{{ value_json.body }}'
    unique_id: tautulli_mqtt_status

  - platform: mqtt
    name: Zigbee2mqtt Networkmap
    # if you change base_topic of Zigbee2mqtt, change state_topic accordingly
    state_topic: zigbee2mqtt/bridge/networkmap/raw
    value_template: >-
      {{ now().strftime('%Y-%m-%d %H:%M:%S') }}
    # again, if you change base_topic of Zigbee2mqtt, change json_attributes_topic accordingly
    json_attributes_topic: zigbee2mqtt/bridge/networkmap/raw

  - platform: sql
    db_url: !secret hass_addon_mariadb_url
    queries:
    - name: HASS DB size
      query: !secret hass_addon_mariadb_size_query
      column: 'value'
      unit_of_measurement: MB

#  - platform: nut
#    name: "APC Back-UPS 550"
#    host: a0d7b954-nut
#    resources:
#      - battery.charge 
#      - battery.charge.low 
#      - battery.charge.warning 
#      - battery.date 
#      - battery.mfr.date 
#      - battery.runtime 
#      - battery.runtime.low 
#      - battery.type 
#      - battery.voltage 
#      - battery.voltage.nominal 
##      - device.mfr 
##      - device.model 
##      - device.serial 
##      - device.type 
##      - driver.name 
##      - driver.parameter.pollfreq 
##      - driver.parameter.pollinterval 
##      - driver.parameter.port
##      - driver.version 
##      - driver.version.data
##      - driver.version.internal
#      - input.sensitivity
#      - input.transfer.high
#      - input.transfer.low
#      - input.voltage
#      - input.voltage.nominal
#      - ups.beeper.status
#      - ups.delay.shutdown
##      - ups.firmware
##      - ups.firmware.aux
#      - ups.load
##      - ups.mfr
##      - ups.mfr.date
##      - ups.model
##      - ups.productid
#      - ups.realpower.nominal
##      - ups.serial 
#      - ups.status
#      - ups.test.result
#      - ups.timer.reboot
#      - ups.timer.shutdown 
##      - ups.vendorid

#  - platform: blockchain
#    addresses:
#      - '9893d2a9-d2a9-4910-b072-ba93f7fc08da'

  - platform: bitcoin
    currency: GBP
    display_options:
      - exchangerate
      - trade_volume_btc


#sensors for HA updates
  - platform: command_line
    name: core_updates
    command: 'curl http://supervisor/core/info -H "Authorization: Bearer $(printenv SUPERVISOR_TOKEN)" | jq ''{"latest_version":.data.version_latest,"installed_version":.data.version,"update_available":.data.update_available}'''
    value_template: '{{ value_json.update_available }}'
    scan_interval: 600
    json_attributes:
      - update_available
      - latest_version
      - installed_version

  - platform: command_line
    name: supervisor_updates
    command: 'curl http://supervisor/supervisor/info -H "Authorization: Bearer $(printenv SUPERVISOR_TOKEN)" | jq ''{"latest_version":.data.version_latest,"installed_version":.data.version,"update_available":.data.update_available}'''
    value_template: '{{ value_json.update_available }}'
    scan_interval: 600
    json_attributes:
      - update_available
      - latest_version
      - installed_version

  - platform: command_line
    name: os_updates
    command: 'curl http://supervisor/os/info -H "Authorization: Bearer $(printenv SUPERVISOR_TOKEN)" | jq ''{"latest_version":.data.version_latest,"installed_version":.data.version,"update_available":.data.update_available}'''
    value_template: '{{ value_json.update_available }}'
    scan_interval: 600
    json_attributes:
      - update_available
      - latest_version
      - installed_version