---

template:
  - sensor:
      - name: "binary_sensor_status_counts"
        state: "{{ 'off' if states('sensor.hacs') | float == 0 else 'on' }}"
        attributes:
          updates_count: "{{ expand('group.all_updates') | selectattr('state','eq', 'on') | list | count }}"
          doors_open_count: "{{ expand('group.all_door_binary_sensors') | selectattr('state','eq', 'on') | list | count }}"
          door_sensors_unavailable_count: "{{ expand('group.all_door_binary_sensors') | selectattr('state','in', ['unavailable','unknown']) | list | count }}"
          lights_on_count: "{{ expand('group.all_lights') | selectattr('state','eq', 'on') | list | count }}"
          occupancy_count: "{{ expand('group.all_occupancy_binary_sensors') | selectattr('state','eq', 'on') | list | count }}"
          occupancy_sensors_unavailable_count: "{{ expand('group.all_occupancy_binary_sensors') | selectattr('state','in', ['unavailable','unknown']) | list | count }}"
          occupancy_persons_home_count: "{{ expand(states.person) | selectattr('state','eq','home') | map(attribute='entity_id') | list | count }}"
          safety_alert_count: "{{ expand('group.all_safety_binary_sensors') | selectattr('state','eq', 'on') | list | count }}"
          safety_sensors_unavailable_count: "{{ expand('group.all_safety_binary_sensors') | selectattr('state','in', ['unavailable','unknown']) | list | count }}"
          zero_value: "{{ 0 | int }}"

  - binary_sensor:
      - name: "kev_driving_status"
        state: "{{ 'on' if states('sensor.iphone_activity') == 'Automotive' else 'off' }}"
